<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starks Galaxy Hub - Enterprise Online Office</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/gantt-schedule-timeline-calendar@3.16.3/dist/style.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --border: #e5e7eb;
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 80px;
            --header-height: 70px;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--light);
        }

        *::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        *::-webkit-scrollbar-track {
            background: var(--light);
        }

        *::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }

        /* Loading States */
        .loading-skeleton {
            animation: skeleton-pulse 1.5s ease-in-out infinite;
            background: linear-gradient(90deg, var(--light) 25%, #e5e7eb 50%, var(--light) 75%);
            background-size: 200% 100%;
            border-radius: 8px;
        }

        @keyframes skeleton-pulse {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        /* Tooltips */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }

        [data-tooltip]:before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: var(--dark);
            color: white;
            font-size: 12px;
            white-space: nowrap;
            border-radius: 6px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            pointer-events: none;
        }

        [data-tooltip]:hover:before {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 10px);
        }

        /* Keyboard Shortcuts */
        .keyboard-shortcut {
            display: inline-block;
            padding: 4px 8px;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            font-family: monospace;
            box-shadow: 0 2px 0 var(--border);
        }

        /* Modern Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 50px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-header h1 {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .company-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .company-badge {
            padding: 8px 16px;
            background: var(--light);
            border: 2px solid var(--border);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .company-badge:hover {
            border-color: var(--primary);
        }

        .company-badge.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Dashboard Layout */
        .dashboard {
            display: none;
            height: 100vh;
            background: #f3f4f6;
            overflow: hidden;
        }

        .app-wrapper {
            display: flex;
            height: 100%;
        }

        /* Modern Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            z-index: 50;
            height: 100vh;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar.collapsed .menu-text,
        .sidebar.collapsed .sidebar-header h3,
        .sidebar.collapsed .user-info span,
        .sidebar.collapsed .company-info {
            display: none;
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            white-space: nowrap;
        }

        .company-info {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-section-title {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--gray);
            margin-bottom: 10px;
            padding-left: 15px;
            letter-spacing: 0.5px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 12px;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .menu-item i {
            width: 24px;
            font-size: 18px;
            margin-right: 12px;
        }

        .menu-item:hover {
            background: var(--light);
        }

        .menu-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 10px 20px -10px var(--primary);
        }

        .menu-item .badge {
            position: absolute;
            right: 15px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #f3f4f6;
        }

        .top-bar {
            background: white;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            height: var(--header-height);
        }

        .page-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--border);
            border-radius: 25px;
            width: 300px;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            width: 350px;
        }

        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .search-shortcut {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 11px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-icon {
            position: relative;
            cursor: pointer;
        }

        .notification-icon i {
            font-size: 20px;
            color: var(--gray);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            position: relative;
        }

        .user-status {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .status-online {
            background: var(--success);
        }

        .status-away {
            background: var(--warning);
        }

        .status-busy {
            background: var(--danger);
        }

        .status-offline {
            background: var(--gray);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* Quick Actions Bar */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            padding: 10px 20px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 30px;
            font-size: 14px;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .quick-action-btn i {
            font-size: 14px;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 14px;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            margin-top: 10px;
        }

        .change-positive {
            color: var(--success);
        }

        .change-negative {
            color: var(--danger);
        }

        /* Kanban Board */
        .kanban-board {
            display: flex;
            gap: 20px;
            height: calc(100vh - 250px);
            overflow-x: auto;
            padding-bottom: 20px;
        }

        .kanban-column {
            min-width: 320px;
            background: #f8fafc;
            border-radius: 16px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .kanban-column.drag-over {
            background: #e2e8f0;
            transform: scale(1.02);
        }

        .kanban-column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 0 5px;
        }

        .column-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 16px;
        }

        .column-count {
            background: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--gray);
            font-weight: 600;
        }

        .kanban-cards {
            flex: 1;
            overflow-y: auto;
            min-height: 100px;
        }

        .kanban-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            cursor: grab;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
        }

        .kanban-card:active {
            cursor: grabbing;
        }

        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .kanban-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .card-priority-high {
            border-left-color: var(--danger);
        }

        .card-priority-medium {
            border-left-color: var(--warning);
        }

        .card-priority-low {
            border-left-color: var(--success);
        }

        .card-priority-critical {
            border-left-color: #7f1d1d;
        }

        .card-tags {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .card-tag {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .card-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .card-description {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
        }

        .card-assignees {
            display: flex;
            align-items: center;
        }

        .assignee-avatar {
            width: 24px;
            height: 24px;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            margin-right: -5px;
            border: 2px solid white;
            font-weight: 600;
        }

        .card-progress {
            margin-top: 10px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--success);
            transition: width 0.3s ease;
        }

        .card-deadline {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .deadline-overdue {
            color: var(--danger);
        }

        .deadline-today {
            color: var(--warning);
        }

        .deadline-upcoming {
            color: var(--success);
        }

        /* Gantt Chart */
        .gantt-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            height: 600px;
        }

        /* Calendar Styles */
        .calendar-wrapper {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .fc {
            height: 600px;
        }

        .fc-event {
            border: none;
            border-radius: 8px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fc-event:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .event-milestone {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
        }

        .event-deadline {
            background: linear-gradient(135deg, #ef4444, #f59e0b);
        }

        .event-meeting {
            background: linear-gradient(135deg, #3b82f6, #2dd4bf);
        }

        /* Chat Interface */
        .chat-container {
            display: flex;
            height: calc(100vh - 200px);
            background: white;
            border-radius: 16px;
            overflow: hidden;
        }

        .chat-sidebar {
            width: 280px;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .chat-search {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .chat-search input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
        }

        .chat-channels {
            flex: 1;
            overflow-y: auto;
        }

        .channel-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .channel-item:hover {
            background: var(--light);
        }

        .channel-item.active {
            background: #eef2ff;
            border-left-color: var(--primary);
        }

        .channel-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .channel-info {
            flex: 1;
        }

        .channel-name {
            font-weight: 600;
            font-size: 14px;
        }

        .channel-last-message {
            font-size: 11px;
            color: var(--gray);
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
        }

        .message-time {
            font-size: 11px;
            color: var(--gray);
        }

        .message-body {
            font-size: 14px;
            line-height: 1.5;
        }

        .message-attachments {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .message-attachment {
            padding: 8px 12px;
            background: var(--light);
            border-radius: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-input {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .chat-actions {
            display: flex;
            gap: 5px;
        }

        .chat-action-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--gray);
        }

        .chat-action-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Video Call Interface */
        .video-call-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            padding: 20px;
        }

        .video-call-container.active {
            display: flex;
            flex-direction: column;
        }

        .video-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .video-participant {
            background: #2d2d2d;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .video-placeholder i {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .participant-name {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            font-size: 12px;
        }

        .call-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: #4b5563;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .call-btn:hover {
            transform: scale(1.1);
        }

        .call-btn.end-call {
            background: var(--danger);
        }

        .call-btn.mute.active {
            background: var(--warning);
        }

        /* Document Management */
        .document-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .document-folder {
            background: white;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .document-folder:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .document-folder i {
            font-size: 32px;
            color: #f59e0b;
            margin-bottom: 10px;
        }

        .document-folder h4 {
            margin-bottom: 5px;
        }

        .document-folder p {
            font-size: 12px;
            color: var(--gray);
        }

        .document-file {
            background: white;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .document-file:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .document-file i {
            font-size: 24px;
            color: var(--primary);
        }

        .document-info {
            flex: 1;
        }

        .document-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .document-meta {
            font-size: 11px;
            color: var(--gray);
        }

        .document-actions {
            display: flex;
            gap: 10px;
        }

        .document-version {
            font-size: 11px;
            padding: 2px 8px;
            background: var(--light);
            border-radius: 12px;
        }

        /* Time Tracking */
        .timer-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .timer-display {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            margin: 20px 0;
            font-family: monospace;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .timesheet-entry {
            background: var(--light);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timesheet-project {
            font-weight: 600;
        }

        .timesheet-time {
            color: var(--gray);
            font-size: 13px;
        }

        .timesheet-duration {
            font-weight: 600;
            color: var(--primary);
        }

        /* Leave Management */
        .leave-request {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .leave-type {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .type-vacation {
            background: #dbeafe;
            color: #2563eb;
        }

        .type-sick {
            background: #fee2e2;
            color: #dc2626;
        }

        .type-personal {
            background: #fef3c7;
            color: #d97706;
        }

        .leave-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-pending {
            background: #fef3c7;
            color: #d97706;
        }

        .status-approved {
            background: #d1fae5;
            color: #059669;
        }

        .status-rejected {
            background: #fee2e2;
            color: #dc2626;
        }

        .leave-balance {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .balance-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .balance-days {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        /* Expense Management */
        .expense-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expense-category {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .category-travel {
            background: #dbeafe;
            color: #2563eb;
        }

        .category-meals {
            background: #fef3c7;
            color: #d97706;
        }

        .category-office {
            background: #d1fae5;
            color: #059669;
        }

        .expense-amount {
            font-weight: 700;
            font-size: 16px;
        }

        .expense-receipt {
            width: 40px;
            height: 40px;
            background: var(--light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Client Portal */
        .client-project {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .client-project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .client-project-title {
            font-weight: 600;
            font-size: 16px;
        }

        .client-project-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-active {
            background: #d1fae5;
            color: #059669;
        }

        .status-completed {
            background: #dbeafe;
            color: #2563eb;
        }

        .status-on-hold {
            background: #fee2e2;
            color: #dc2626;
        }

        .client-feedback {
            margin-top: 15px;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
        }

        .feedback-author {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .feedback-text {
            font-size: 13px;
            color: var(--gray);
            line-height: 1.5;
        }

        .feedback-time {
            font-size: 11px;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Artist Portfolio */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .portfolio-item {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .portfolio-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .portfolio-thumbnail {
            height: 200px;
            background: var(--light);
            position: relative;
        }

        .portfolio-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .portfolio-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
        }

        .portfolio-info {
            padding: 15px;
        }

        .portfolio-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .portfolio-artist {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .portfolio-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .portfolio-tag {
            padding: 2px 8px;
            background: var(--light);
            border-radius: 12px;
            font-size: 10px;
        }

        .creative-brief {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .brief-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .brief-title {
            font-weight: 600;
            font-size: 16px;
        }

        .brief-deadline {
            color: var(--danger);
            font-size: 13px;
        }

        .brief-requirements {
            margin: 15px 0;
            padding-left: 20px;
        }

        .brief-requirements li {
            margin-bottom: 5px;
            font-size: 13px;
        }

        .brief-attachments {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .brief-attachment {
            padding: 8px 12px;
            background: var(--light);
            border-radius: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rights-management {
            background: white;
            border-radius: 12px;
            padding: 20px;
        }

        .rights-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        .rights-item:last-child {
            border-bottom: none;
        }

        .rights-type {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .rights-details {
            font-size: 12px;
            color: var(--gray);
        }

        .rights-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .rights-active {
            background: #d1fae5;
            color: #059669;
        }

        .rights-expired {
            background: #fee2e2;
            color: #dc2626;
        }

        .rights-pending {
            background: #fef3c7;
            color: #d97706;
        }

        /* Workflow Automation */
        .workflow-builder {
            background: white;
            border-radius: 16px;
            padding: 20px;
            min-height: 400px;
        }

        .workflow-node {
            background: var(--light);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.3s ease;
        }

        .workflow-node:hover {
            border-color: var(--primary);
        }

        .workflow-node.dragging {
            opacity: 0.5;
        }

        .node-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .node-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .node-title {
            font-weight: 600;
        }

        .node-conditions {
            font-size: 12px;
            color: var(--gray);
            margin-left: 40px;
        }

        .workflow-connector {
            height: 30px;
            width: 2px;
            background: var(--border);
            margin-left: 25px;
        }

        .automation-rule {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .rule-trigger {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rule-trigger i {
            color: var(--primary);
        }

        .rule-action {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rule-action i {
            color: var(--success);
        }

        .rule-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .rule-active {
            background: #d1fae5;
            color: #059669;
        }

        .rule-inactive {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Reports & Analytics */
        .report-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .report-title {
            font-weight: 600;
        }

        .report-date {
            font-size: 12px;
            color: var(--gray);
        }

        .report-chart {
            height: 300px;
            margin: 20px 0;
        }

        .report-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-item {
            text-align: center;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 12px;
            color: var(--gray);
        }

        .export-options {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }

        .export-btn {
            padding: 8px 16px;
            background: var(--light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .export-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Admin Panel */
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        .permission-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .permission-card h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 16px;
        }

        .permission-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: var(--light);
            border-radius: 10px;
        }

        .permission-toggle {
            width: 50px;
            height: 24px;
            background: var(--border);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .permission-toggle.active {
            background: var(--success);
        }

        .permission-toggle.active::after {
            left: 28px;
        }

        .permission-toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .company-management {
            margin-bottom: 20px;
        }

        .company-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .company-logo {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .company-details {
            flex: 1;
            margin-left: 15px;
        }

        .company-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .company-subdomain {
            font-size: 11px;
            color: var(--gray);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-lg {
            max-width: 800px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            font-size: 18px;
            color: var(--dark);
        }

        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-control.error {
            border-color: var(--danger);
        }

        .error-message {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -10px var(--primary);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Rich Text Editor */
        .quill-editor {
            height: 200px;
            margin-bottom: 20px;
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: var(--light);
        }

        .file-upload-area i {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .file-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .file-preview-item {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-preview-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: var(--header-height);
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            z-index: 200;
            display: none;
        }

        .notification-panel.active {
            display: block;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h4 {
            font-size: 16px;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-item:hover {
            background: var(--light);
        }

        .notification-item.unread {
            background: #eef2ff;
        }

        .notification-item.unread:hover {
            background: #e0e7ff;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .notification-message {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 10px;
            color: var(--gray);
        }

        /* User Menu Dropdown */
        .user-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            width: 250px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 100;
        }

        .user-dropdown.active {
            display: block;
        }

        .dropdown-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-user-name {
            font-weight: 600;
        }

        .dropdown-user-email {
            font-size: 12px;
            color: var(--gray);
        }

        .dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dropdown-item:hover {
            background: var(--light);
        }

        .dropdown-item i {
            width: 20px;
            color: var(--gray);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 5px 0;
        }

        .user-status-selector {
            padding: 10px 15px;
        }

        .status-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
        }

        .status-option:hover {
            background: var(--light);
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Keyboard Shortcuts Modal */
        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--light);
            border-radius: 8px;
        }

        .shortcut-keys {
            display: flex;
            gap: 5px;
        }

        .shortcut-key {
            padding: 4px 8px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 12px;
            font-family: monospace;
        }

        /* Onboarding Tutorial */
        .onboarding-tooltip {
            position: fixed;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            max-width: 300px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2); }
            50% { box-shadow: 0 20px 50px rgba(37, 99, 235, 0.3); }
            100% { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2); }
        }

        .onboarding-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .onboarding-arrow.top {
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 10px 10px 10px;
            border-color: transparent transparent white transparent;
        }

        .onboarding-arrow.bottom {
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 10px 10px 0 10px;
            border-color: white transparent transparent transparent;
        }

        .onboarding-arrow.left {
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-width: 10px 10px 10px 0;
            border-color: transparent white transparent transparent;
        }

        .onboarding-arrow.right {
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-width: 10px 0 10px 10px;
            border-color: transparent transparent transparent white;
        }

        .onboarding-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .onboarding-text {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .onboarding-progress {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 15px 0;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
        }

        .progress-dot.active {
            background: var(--primary);
        }

        .onboarding-buttons {
            display: flex;
            justify-content: space-between;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: -280px;
                height: 100vh;
                z-index: 100;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }

            .admin-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .top-bar {
                padding: 15px;
            }

            .search-bar input {
                width: 200px;
            }

            .search-bar input:focus {
                width: 250px;
            }

            .quick-actions {
                justify-content: center;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .chat-container {
                flex-direction: column;
            }

            .chat-sidebar {
                width: 100%;
                height: 200px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .focus-visible:focus-visible {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        [aria-hidden="true"] {
            display: none;
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .top-bar,
            .quick-actions,
            .btn {
                display: none !important;
            }

            .main-content {
                margin: 0;
                padding: 20px;
            }

            .content-area {
                overflow: visible;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <h1>Starks Galaxy Hub</h1>
                    <p>Enterprise Online Office</p>
                </div>
                
                <div class="company-selector" id="companySelector">
                    <div class="company-badge active" data-company="starks">Starks Galaxy</div>
                    <div class="company-badge" data-company="fortifyai">FortifyAI</div>
                    <div class="company-badge" data-company="epicsounds">Epic Sounds</div>
                </div>
                
                <div id="loginForm">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" autocomplete="current-password">
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="rememberMe"> Remember me
                        </label>
                        <a href="#" onclick="forgotPassword()" style="color: var(--primary); text-decoration: none; font-size: 14px;">Forgot Password?</a>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="handleLogin()" id="loginBtn">Login</button>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <span style="color: var(--gray);">Don't have an account?</span>
                        <a href="#" onclick="showRegister()" style="color: var(--primary); text-decoration: none;">Request Access</a>
                    </div>

                    <div style="text-align: center;">
                        <span style="color: var(--gray); font-size: 13px;">Demo: admin@starks.com / password</span>
                    </div>
                </div>

                <div id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="regName" class="form-control" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label>Company</label>
                        <select id="regCompany" class="form-control">
                            <option value="starks">Starks Galaxy Limited</option>
                            <option value="fortifyai">FortifyAI International</option>
                            <option value="epicsounds">Epic Sounds RL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Department</label>
                        <input type="text" id="regDepartment" class="form-control" placeholder="Enter department">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select id="regRole" class="form-control">
                            <option value="user">Team Member</option>
                            <option value="manager">Project Manager</option>
                            <option value="artist">Artist/Creative</option>
                            <option value="client">Client/Guest</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="handleRegister()">Submit Request</button>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <a href="#" onclick="showLogin()" style="color: var(--primary); text-decoration: none;">Back to Login</a>
                    </div>
                </div>

                <div id="forgotPasswordForm" style="display: none;">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="resetEmail" class="form-control" placeholder="Enter your email">
                    </div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="resetPassword()">Send Reset Link</button>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <a href="#" onclick="showLogin()" style="color: var(--primary); text-decoration: none;">Back to Login</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard">
            <div class="app-wrapper">
                <!-- Sidebar -->
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <div>
                            <h3>Starks Galaxy Hub</h3>
                            <div class="company-info" id="currentCompany">Starks Galaxy Limited</div>
                        </div>
                        <i class="fas fa-chevron-left" onclick="toggleSidebar()" style="cursor: pointer; color: var(--gray);"></i>
                    </div>

                    <div class="sidebar-menu">
                        <div class="menu-section">
                            <div class="menu-section-title">Main</div>
                            <div class="menu-item active" onclick="switchTab('dashboard')" data-tooltip="Dashboard">
                                <i class="fas fa-home"></i>
                                <span class="menu-text">Dashboard</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('projects')" data-tooltip="Projects">
                                <i class="fas fa-project-diagram"></i>
                                <span class="menu-text">Projects</span>
                                <span class="badge" id="projectBadge">0</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('tasks')" data-tooltip="My Tasks">
                                <i class="fas fa-tasks"></i>
                                <span class="menu-text">My Tasks</span>
                                <span class="badge" id="taskBadge">0</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('calendar')" data-tooltip="Calendar">
                                <i class="fas fa-calendar-alt"></i>
                                <span class="menu-text">Calendar</span>
                            </div>
                        </div>

                        <div class="menu-section">
                            <div class="menu-section-title">Collaboration</div>
                            <div class="menu-item" onclick="switchTab('chat')" data-tooltip="Chat">
                                <i class="fas fa-comments"></i>
                                <span class="menu-text">Chat</span>
                                <span class="badge" id="chatBadge">0</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('video')" data-tooltip="Video Calls">
                                <i class="fas fa-video"></i>
                                <span class="menu-text">Video Calls</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('team')" data-tooltip="Team">
                                <i class="fas fa-users"></i>
                                <span class="menu-text">Team</span>
                            </div>
                        </div>

                        <div class="menu-section">
                            <div class="menu-section-title">Creative</div>
                            <div class="menu-item" onclick="switchTab('artists')" id="artistMenuItem" data-tooltip="Artist Panel">
                                <i class="fas fa-paint-brush"></i>
                                <span class="menu-text">Artist Panel</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('portfolio')" data-tooltip="Portfolio">
                                <i class="fas fa-images"></i>
                                <span class="menu-text">Portfolio</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('briefs')" data-tooltip="Creative Briefs">
                                <i class="fas fa-file-alt"></i>
                                <span class="menu-text">Briefs</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('rights')" data-tooltip="Rights Management">
                                <i class="fas fa-copyright"></i>
                                <span class="menu-text">Rights</span>
                            </div>
                        </div>

                        <div class="menu-section">
                            <div class="menu-section-title">Management</div>
                            <div class="menu-item" onclick="switchTab('gantt')" data-tooltip="Gantt Chart">
                                <i class="fas fa-chart-gantt"></i>
                                <span class="menu-text">Gantt</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('time')" data-tooltip="Time Tracking">
                                <i class="fas fa-clock"></i>
                                <span class="menu-text">Time Tracking</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('expenses')" data-tooltip="Expenses">
                                <i class="fas fa-receipt"></i>
                                <span class="menu-text">Expenses</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('hr')" data-tooltip="HR">
                                <i class="fas fa-user-tie"></i>
                                <span class="menu-text">HR</span>
                            </div>
                        </div>

                        <div class="menu-section">
                            <div class="menu-section-title">Documents</div>
                            <div class="menu-item" onclick="switchTab('documents')" data-tooltip="Documents">
                                <i class="fas fa-folder"></i>
                                <span class="menu-text">Documents</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('vault')" data-tooltip="Secure Vault">
                                <i class="fas fa-lock"></i>
                                <span class="menu-text">Vault</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('templates')" data-tooltip="Templates">
                                <i class="fas fa-copy"></i>
                                <span class="menu-text">Templates</span>
                            </div>
                        </div>

                        <div class="menu-section">
                            <div class="menu-section-title">Clients</div>
                            <div class="menu-item" onclick="switchTab('clients')" data-tooltip="Clients">
                                <i class="fas fa-handshake"></i>
                                <span class="menu-text">Clients</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('portal')" data-tooltip="Client Portal">
                                <i class="fas fa-external-link-alt"></i>
                                <span class="menu-text">Portal</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('invoices')" data-tooltip="Invoices">
                                <i class="fas fa-file-invoice"></i>
                                <span class="menu-text">Invoices</span>
                            </div>
                        </div>

                        <div class="menu-section">
                            <div class="menu-section-title">Analytics</div>
                            <div class="menu-item" onclick="switchTab('reports')" data-tooltip="Reports">
                                <i class="fas fa-chart-bar"></i>
                                <span class="menu-text">Reports</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('analytics')" data-tooltip="Analytics">
                                <i class="fas fa-chart-line"></i>
                                <span class="menu-text">Analytics</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('dashboard')" data-tooltip="Dashboards">
                                <i class="fas fa-chart-pie"></i>
                                <span class="menu-text">Dashboards</span>
                            </div>
                        </div>

                        <div class="menu-section">
                            <div class="menu-section-title">Automation</div>
                            <div class="menu-item" onclick="switchTab('workflows')" data-tooltip="Workflows">
                                <i class="fas fa-diagram-project"></i>
                                <span class="menu-text">Workflows</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('rules')" data-tooltip="Automation Rules">
                                <i class="fas fa-robot"></i>
                                <span class="menu-text">Rules</span>
                            </div>
                        </div>

                        <div class="menu-section" id="adminMenuSection" style="display: none;">
                            <div class="menu-section-title">Administration</div>
                            <div class="menu-item" onclick="switchTab('admin')" data-tooltip="Admin Panel">
                                <i class="fas fa-user-cog"></i>
                                <span class="menu-text">Admin</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('companies')" data-tooltip="Companies">
                                <i class="fas fa-building"></i>
                                <span class="menu-text">Companies</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('permissions')" data-tooltip="Permissions">
                                <i class="fas fa-shield-alt"></i>
                                <span class="menu-text">Permissions</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('audit')" data-tooltip="Audit Log">
                                <i class="fas fa-history"></i>
                                <span class="menu-text">Audit</span>
                            </div>
                            <div class="menu-item" onclick="switchTab('security')" data-tooltip="Security">
                                <i class="fas fa-lock"></i>
                                <span class="menu-text">Security</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-footer" style="padding: 20px; border-top: 1px solid var(--border);">
                        <div class="menu-item" onclick="toggleSidebar()">
                            <i class="fas fa-chevron-left"></i>
                            <span class="menu-text">Collapse</span>
                        </div>
                        <div class="menu-item" onclick="showKeyboardShortcuts()">
                            <i class="fas fa-keyboard"></i>
                            <span class="menu-text">Shortcuts</span>
                        </div>
                        <div class="menu-item" onclick="handleLogout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="menu-text">Logout</span>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content">
                    <div class="top-bar">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-bars" onclick="toggleMobileSidebar()" style="font-size: 20px; cursor: pointer; display: none;"></i>
                            <h2 class="page-title" id="pageTitle">Dashboard</h2>
                            <span class="keyboard-shortcut" id="currentViewShortcut">Ctrl+D</span>
                        </div>

                        <div class="top-bar-actions">
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Search anything... (Ctrl+K)" id="globalSearch">
                                <span class="search-shortcut">K</span>
                            </div>
                            
                            <div class="user-menu">
                                <div class="notification-icon" onclick="toggleNotifications()" data-tooltip="Notifications">
                                    <i class="far fa-bell"></i>
                                    <span class="notification-badge" id="notificationCount">0</span>
                                </div>
                                <div class="user-avatar" id="userAvatar" onclick="toggleUserMenu()">
                                    U
                                    <span class="user-status status-online" id="userStatus"></span>
                                </div>
                                <!-- User Dropdown -->
                                <div class="user-dropdown" id="userDropdown">
                                    <div class="dropdown-header">
                                        <div class="dropdown-user-name" id="dropdownUserName">User Name</div>
                                        <div class="dropdown-user-email" id="dropdownUserEmail">user@email.com</div>
                                    </div>
                                    <div class="dropdown-item" onclick="switchTab('profile')">
                                        <i class="fas fa-user"></i> My Profile
                                    </div>
                                    <div class="dropdown-item" onclick="switchTab('settings')">
                                        <i class="fas fa-cog"></i> Settings
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <div class="dropdown-item" onclick="setStatus('online')">
                                        <span class="status-indicator" style="background: var(--success);"></span> Online
                                    </div>
                                    <div class="dropdown-item" onclick="setStatus('away')">
                                        <span class="status-indicator" style="background: var(--warning);"></span> Away
                                    </div>
                                    <div class="dropdown-item" onclick="setStatus('busy')">
                                        <span class="status-indicator" style="background: var(--danger);"></span> Busy
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <div class="dropdown-item" onclick="handleLogout()">
                                        <i class="fas fa-sign-out-alt"></i> Logout
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="content-area">
                        <!-- Quick Actions -->
                        <div class="quick-actions" id="quickActions">
                            <button class="quick-action-btn" onclick="openQuickTask()">
                                <i class="fas fa-plus"></i> Quick Task
                            </button>
                            <button class="quick-action-btn" onclick="openQuickProject()">
                                <i class="fas fa-folder-plus"></i> New Project
                            </button>
                            <button class="quick-action-btn" onclick="startVideoCall()">
                                <i class="fas fa-video"></i> Start Call
                            </button>
                            <button class="quick-action-btn" onclick="openChat()">
                                <i class="fas fa-comment"></i> New Chat
                            </button>
                            <button class="quick-action-btn" onclick="uploadDocument()">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                            <button class="quick-action-btn" onclick="startTimer()">
                                <i class="fas fa-clock"></i> Start Timer
                            </button>
                        </div>

                        <!-- Loading State -->
                        <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center;">
                            <div class="loading-spinner"></div>
                        </div>

                        <!-- Dashboard Tab -->
                        <div id="dashboardTab" class="tab-content">
                            <div class="cards-grid">
                                <div class="stat-card">
                                    <div class="stat-header">
                                        <div>
                                            <div class="stat-value" id="totalProjects">0</div>
                                            <div class="stat-label">Total Projects</div>
                                        </div>
                                        <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary), var(--secondary));">
                                            <i class="fas fa-project-diagram"></i>
                                        </div>
                                    </div>
                                    <div class="stat-change change-positive">
                                        <i class="fas fa-arrow-up"></i> <span id="projectChange">+12%</span> from last month
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <div class="stat-header">
                                        <div>
                                            <div class="stat-value" id="activeTasks">0</div>
                                            <div class="stat-label">Active Tasks</div>
                                        </div>
                                        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                                            <i class="fas fa-tasks"></i>
                                        </div>
                                    </div>
                                    <div class="stat-change change-positive">
                                        <i class="fas fa-arrow-up"></i> <span id="taskChange">+8%</span> from yesterday
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <div class="stat-header">
                                        <div>
                                            <div class="stat-value" id="teamMembers">0</div>
                                            <div class="stat-label">Team Members</div>
                                        </div>
                                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                                            <i class="fas fa-users"></i>
                                        </div>
                                    </div>
                                    <div class="stat-change change-positive">
                                        <i class="fas fa-user-plus"></i> <span id="memberChange">+3</span> new this week
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <div class="stat-header">
                                        <div>
                                            <div class="stat-value" id="completionRate">0%</div>
                                            <div class="stat-label">Completion Rate</div>
                                        </div>
                                        <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #f87171);">
                                            <i class="fas fa-chart-pie"></i>
                                        </div>
                                    </div>
                                    <div class="stat-change change-positive">
                                        <i class="fas fa-arrow-up"></i> <span id="rateChange">+5%</span> vs target
                                    </div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px;">
                                <div class="permission-card">
                                    <h3>Recent Activity</h3>
                                    <div id="activityFeed" style="margin-top: 20px;">
                                        <!-- Activity items will be loaded here -->
                                    </div>
                                </div>

                                <div class="permission-card">
                                    <h3>Upcoming Deadlines</h3>
                                    <div id="upcomingDeadlines" style="margin-top: 20px;">
                                        <!-- Deadlines will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 25px; display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                                <div class="permission-card">
                                    <h3>Team Online Now</h3>
                                    <div id="onlineTeam" style="margin-top: 20px;">
                                        <!-- Online team members will be loaded here -->
                                    </div>
                                </div>

                                <div class="permission-card">
                                    <h3>Recent Documents</h3>
                                    <div id="recentDocuments" style="margin-top: 20px;">
                                        <!-- Recent documents will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Projects Tab -->
                        <div id="projectsTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>All Projects</h3>
                                <div style="display: flex; gap: 10px;">
                                    <select id="projectFilter" class="form-control" style="width: 150px;" onchange="filterProjects()">
                                        <option value="all">All Projects</option>
                                        <option value="active">Active</option>
                                        <option value="completed">Completed</option>
                                        <option value="on-hold">On Hold</option>
                                    </select>
                                    <button class="btn btn-primary" onclick="openProjectModal()">
                                        <i class="fas fa-plus"></i> New Project
                                    </button>
                                </div>
                            </div>
                            <div id="projectsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px;">
                                <!-- Projects will be loaded here -->
                            </div>
                        </div>

                        <!-- Tasks Tab -->
                        <div id="tasksTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>My Tasks</h3>
                                <div style="display: flex; gap: 10px;">
                                    <select id="taskFilter" class="form-control" style="width: 150px;" onchange="loadMyTasks()">
                                        <option value="all">All Tasks</option>
                                        <option value="todo">To Do</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="review">Review</option>
                                        <option value="done">Completed</option>
                                    </select>
                                    <button class="btn btn-primary" onclick="openTaskModal()">
                                        <i class="fas fa-plus"></i> New Task
                                    </button>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;" id="myTasksList">
                                <!-- Tasks will be loaded here -->
                            </div>
                        </div>

                        <!-- Chat Tab -->
                        <div id="chatTab" class="tab-content" style="display: none;">
                            <div class="chat-container">
                                <div class="chat-sidebar">
                                    <div class="chat-search">
                                        <input type="text" placeholder="Search conversations..." id="chatSearch">
                                    </div>
                                    <div class="chat-channels" id="chatChannels">
                                        <!-- Channels will be loaded here -->
                                    </div>
                                </div>
                                <div class="chat-main" id="chatMain">
                                    <div class="chat-header">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <div class="channel-icon" id="currentChannelIcon">
                                                <i class="fas fa-hashtag"></i>
                                            </div>
                                            <div>
                                                <h4 id="currentChannelName">General</h4>
                                                <span style="font-size: 12px; color: var(--gray);" id="channelMemberCount">5 members</span>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 10px;">
                                            <button class="btn btn-outline btn-sm" onclick="startVideoCall()">
                                                <i class="fas fa-video"></i>
                                            </button>
                                            <button class="btn btn-outline btn-sm" onclick="showChannelInfo()">
                                                <i class="fas fa-info-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="chat-messages" id="chatMessages">
                                        <!-- Messages will be loaded here -->
                                    </div>
                                    <div class="chat-input">
                                        <input type="text" placeholder="Type a message... (Enter to send)" id="chatMessageInput" onkeypress="handleChatKeyPress(event)">
                                        <div class="chat-actions">
                                            <button class="chat-action-btn" onclick="attachFile()">
                                                <i class="fas fa-paperclip"></i>
                                            </button>
                                            <button class="chat-action-btn" onclick="sendMessage()">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Video Call Container -->
                        <div class="video-call-container" id="videoCallContainer">
                            <div class="video-grid" id="videoGrid">
                                <!-- Video participants will be added here -->
                            </div>
                            <div class="call-controls">
                                <button class="call-btn" onclick="toggleMute()" id="muteBtn">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button class="call-btn" onclick="toggleVideo()" id="videoBtn">
                                    <i class="fas fa-video"></i>
                                </button>
                                <button class="call-btn" onclick="toggleScreenShare()" id="screenBtn">
                                    <i class="fas fa-desktop"></i>
                                </button>
                                <button class="call-btn end-call" onclick="endCall()">
                                    <i class="fas fa-phone-slash"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Artist Panel Tab -->
                        <div id="artistsTab" class="tab-content" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px;">
                                <div class="permission-card">
                                    <h3>My Creative Tasks</h3>
                                    <div id="artistTasksList" style="margin-top: 20px;">
                                        <!-- Tasks will be loaded here -->
                                    </div>
                                </div>

                                <div class="permission-card">
                                    <h3>Active Briefs</h3>
                                    <div id="activeBriefs" style="margin-top: 20px;">
                                        <!-- Briefs will be loaded here -->
                                    </div>
                                </div>

                                <div class="permission-card">
                                    <h3>Performance Metrics</h3>
                                    <canvas id="artistPerformanceChart" style="height: 300px;"></canvas>
                                    
                                    <div style="margin-top: 20px;">
                                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--light); border-radius: 10px; margin-bottom: 10px;">
                                            <span>Tasks Completed:</span>
                                            <strong id="tasksCompleted">0</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--light); border-radius: 10px; margin-bottom: 10px;">
                                            <span>On-Time Completion:</span>
                                            <strong id="onTimeRate">0%</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; padding: 10px; background: var(--light); border-radius: 10px;">
                                            <span>Quality Rating:</span>
                                            <strong id="qualityRating">0/5</strong>
                                        </div>
                                    </div>
                                </div>

                                <div class="permission-card">
                                    <h3>Recent Deliverables</h3>
                                    <div id="recentDeliverables" style="margin-top: 20px;">
                                        <!-- Deliverables will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Portfolio Tab -->
                        <div id="portfolioTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Creative Portfolio</h3>
                                <button class="btn btn-primary" onclick="addPortfolioItem()">
                                    <i class="fas fa-plus"></i> Add Work
                                </button>
                            </div>
                            <div class="portfolio-grid" id="portfolioGrid">
                                <!-- Portfolio items will be loaded here -->
                            </div>
                        </div>

                        <!-- Rights Management Tab -->
                        <div id="rightsTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Rights & Royalties</h3>
                                <button class="btn btn-primary" onclick="addRightsContract()">
                                    <i class="fas fa-plus"></i> New Contract
                                </button>
                            </div>
                            <div class="rights-management" id="rightsList">
                                <!-- Rights contracts will be loaded here -->
                            </div>
                        </div>

                        <!-- Gantt Tab -->
                        <div id="ganttTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Project Timeline</h3>
                                <div style="display: flex; gap: 10px;">
                                    <select id="ganttProjectSelector" class="form-control" style="width: 200px;" onchange="loadGantt()">
                                        <option value="">Select Project</option>
                                    </select>
                                    <button class="btn btn-outline" onclick="exportGantt()">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                            <div class="gantt-container" id="ganttChart">
                                <!-- Gantt chart will be rendered here -->
                            </div>
                        </div>

                        <!-- Time Tracking Tab -->
                        <div id="timeTab" class="tab-content" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px;">
                                <div class="timer-container">
                                    <h3>Time Tracker</h3>
                                    <div class="timer-display" id="timerDisplay">00:00:00</div>
                                    <div class="timer-controls">
                                        <button class="btn btn-success" onclick="startTimer()" id="startTimerBtn">
                                            <i class="fas fa-play"></i> Start
                                        </button>
                                        <button class="btn btn-warning" onclick="pauseTimer()" id="pauseTimerBtn" style="display: none;">
                                            <i class="fas fa-pause"></i> Pause
                                        </button>
                                        <button class="btn btn-danger" onclick="stopTimer()" id="stopTimerBtn">
                                            <i class="fas fa-stop"></i> Stop
                                        </button>
                                    </div>
                                    <div style="margin-top: 20px;">
                                        <select id="timerProject" class="form-control" style="margin-bottom: 10px;">
                                            <option value="">Select Project</option>
                                        </select>
                                        <select id="timerTask" class="form-control">
                                            <option value="">Select Task</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="permission-card">
                                    <h3>Today's Timesheet</h3>
                                    <div id="todaysTimesheet">
                                        <!-- Timesheet entries will be loaded here -->
                                    </div>
                                </div>

                                <div class="permission-card">
                                    <h3>Weekly Summary</h3>
                                    <canvas id="timeChart" style="height: 300px;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Expenses Tab -->
                        <div id="expensesTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Expense Management</h3>
                                <button class="btn btn-primary" onclick="addExpense()">
                                    <i class="fas fa-plus"></i> New Expense
                                </button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 25px;">
                                <div class="stat-card">
                                    <div class="stat-value" id="totalExpenses">$0</div>
                                    <div class="stat-label">Total Expenses (This Month)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="pendingExpenses">$0</div>
                                    <div class="stat-label">Pending Approval</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="reimbursedExpenses">$0</div>
                                    <div class="stat-label">Reimbursed</div>
                                </div>
                            </div>

                            <div class="permission-card">
                                <h3>Recent Expenses</h3>
                                <div id="expensesList">
                                    <!-- Expenses will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- HR Tab -->
                        <div id="hrTab" class="tab-content" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px;">
                                <!-- Leave Management -->
                                <div class="permission-card">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                                        <h3>Leave Requests</h3>
                                        <button class="btn btn-primary btn-sm" onclick="requestLeave()">
                                            <i class="fas fa-plus"></i> Request Leave
                                        </button>
                                    </div>
                                    <div class="leave-balance" id="leaveBalance">
                                        <!-- Leave balance will be loaded here -->
                                    </div>
                                    <div id="leaveRequests">
                                        <!-- Leave requests will be loaded here -->
                                    </div>
                                </div>

                                <!-- Employee Directory -->
                                <div class="permission-card">
                                    <h3>Employee Directory</h3>
                                    <div style="margin-bottom: 15px;">
                                        <input type="text" class="form-control" placeholder="Search employees..." id="employeeSearch">
                                    </div>
                                    <div id="employeeDirectory" style="max-height: 400px; overflow-y: auto;">
                                        <!-- Employees will be loaded here -->
                                    </div>
                                </div>

                                <!-- Upcoming Birthdays -->
                                <div class="permission-card">
                                    <h3>Upcoming Birthdays</h3>
                                    <div id="upcomingBirthdays">
                                        <!-- Birthdays will be loaded here -->
                                    </div>
                                </div>

                                <!-- Training -->
                                <div class="permission-card">
                                    <h3>Training & Development</h3>
                                    <div id="trainingList">
                                        <!-- Training items will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Documents Tab -->
                        <div id="documentsTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Document Management</h3>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-outline" onclick="newFolder()">
                                        <i class="fas fa-folder-plus"></i> New Folder
                                    </button>
                                    <button class="btn btn-primary" onclick="uploadDocument()">
                                        <i class="fas fa-upload"></i> Upload
                                    </button>
                                </div>
                            </div>

                            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                                <div class="breadcrumb" id="documentBreadcrumb">
                                    <span onclick="navigateToFolder('root')">Root</span>
                                </div>
                            </div>

                            <div class="document-grid" id="documentsGrid">
                                <!-- Documents will be loaded here -->
                            </div>
                        </div>

                        <!-- Clients Tab -->
                        <div id="clientsTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Client Management</h3>
                                <button class="btn btn-primary" onclick="addClient()">
                                    <i class="fas fa-user-plus"></i> Add Client
                                </button>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;" id="clientsList">
                                <!-- Clients will be loaded here -->
                            </div>
                        </div>

                        <!-- Client Portal Tab -->
                        <div id="portalTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Client Portal</h3>
                                <select id="clientSelector" class="form-control" style="width: 200px;" onchange="loadClientPortal()">
                                    <option value="">Select Client</option>
                                </select>
                            </div>

                            <div id="clientPortalContent">
                                <!-- Client portal content will be loaded here -->
                            </div>
                        </div>

                        <!-- Workflows Tab -->
                        <div id="workflowsTab" class="tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3>Workflow Automation</h3>
                                <button class="btn btn-primary" onclick="createWorkflow()">
                                    <i class="fas fa-plus"></i> New Workflow
                                </button>
                            </div>

                            <div class="workflow-builder" id="workflowBuilder">
                                <!-- Workflow builder will be loaded here -->
                            </div>

                            <div style="margin-top: 25px;">
                                <h4>Active Automation Rules</h4>
                                <div id="automationRules">
                                    <!-- Automation rules will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Reports Tab -->
                        <div id="reportsTab" class="tab-content" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px;">
                                <!-- Report Generator -->
                                <div class="permission-card">
                                    <h3>Generate Report</h3>
                                    <div class="form-group">
                                        <label>Report Type</label>
                                        <select id="reportType" class="form-control">
                                            <option value="project">Project Progress Report</option>
                                            <option value="artist">Artist Performance Report</option>
                                            <option value="timeline">Timeline Analysis</option>
                                            <option value="resource">Resource Allocation</option>
                                            <option value="budget">Budget & Cost Report</option>
                                            <option value="productivity">Team Productivity</option>
                                            <option value="client">Client Activity Report</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Date Range</label>
                                        <div style="display: flex; gap: 10px;">
                                            <input type="date" id="reportStartDate" class="form-control">
                                            <input type="date" id="reportEndDate" class="form-control">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Format</label>
                                        <select id="reportFormat" class="form-control">
                                            <option value="pdf">PDF</option>
                                            <option value="excel">Excel</option>
                                            <option value="csv">CSV</option>
                                            <option value="json">JSON</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Schedule</label>
                                        <select id="reportSchedule" class="form-control">
                                            <option value="none">Run once</option>
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary" style="width: 100%;" onclick="generateReport()">
                                        <i class="fas fa-file-export"></i> Generate Report
                                    </button>
                                </div>

                                <!-- Recent Reports -->
                                <div class="permission-card">
                                    <h3>Recent Reports</h3>
                                    <div id="recentReportsList" style="margin-top: 20px;">
                                        <!-- Reports will be loaded here -->
                                    </div>
                                </div>

                                <!-- Scheduled Reports -->
                                <div class="permission-card">
                                    <h3>Scheduled Reports</h3>
                                    <div id="scheduledReportsList" style="margin-top: 20px;">
                                        <!-- Scheduled reports will be loaded here -->
                                    </div>
                                </div>

                                <!-- Report Templates -->
                                <div class="permission-card">
                                    <h3>Report Templates</h3>
                                    <div id="reportTemplates">
                                        <!-- Report templates will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Analytics Tab -->
                        <div id="analyticsTab" class="tab-content" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">
                                <div class="permission-card">
                                    <h3>Project Progress</h3>
                                    <canvas id="projectProgressChart" style="height: 300px;"></canvas>
                                </div>
                                <div class="permission-card">
                                    <h3>Team Workload</h3>
                                    <canvas id="teamWorkloadChart" style="height: 300px;"></canvas>
                                </div>
                                <div class="permission-card">
                                    <h3>Task Completion Trend</h3>
                                    <canvas id="taskTrendChart" style="height: 300px;"></canvas>
                                </div>
                                <div class="permission-card">
                                    <h3>Budget Utilization</h3>
                                    <canvas id="budgetChart" style="height: 300px;"></canvas>
                                </div>
                                <div class="permission-card" style="grid-column: span 2;">
                                    <h3>Resource Allocation</h3>
                                    <canvas id="resourceChart" style="height: 400px;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Panel Tab -->
                        <div id="adminTab" class="tab-content" style="display: none;">
                            <div class="admin-grid">
                                <!-- User Management -->
                                <div class="permission-card">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                        <h3>User Management</h3>
                                        <button class="btn btn-primary" onclick="openUserModal()">
                                            <i class="fas fa-user-plus"></i> Add User
                                        </button>
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <input type="text" class="form-control" placeholder="Search users..." id="userSearch">
                                    </div>
                                    <div id="userManagementList" style="max-height: 400px; overflow-y: auto;">
                                        <!-- Users will be loaded here -->
                                    </div>
                                </div>

                                <!-- Company Management -->
                                <div class="permission-card">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                        <h3>Company Management</h3>
                                        <button class="btn btn-primary" onclick="addCompany()">
                                            <i class="fas fa-plus"></i> Add Company
                                        </button>
                                    </div>
                                    <div id="companyList" class="company-management">
                                        <!-- Companies will be loaded here -->
                                    </div>
                                </div>

                                <!-- Role Permissions -->
                                <div class="permission-card">
                                    <h3>Role Permissions</h3>
                                    <div class="permission-list" id="rolePermissions">
                                        <!-- Permissions will be loaded here -->
                                    </div>
                                </div>

                                <!-- Module Visibility -->
                                <div class="permission-card">
                                    <h3>Module Visibility</h3>
                                    <div id="moduleVisibility" class="permission-list">
                                        <!-- Module toggles will be loaded here -->
                                    </div>
                                </div>

                                <!-- Security Settings -->
                                <div class="permission-card">
                                    <h3>Security Settings</h3>
                                    <div class="form-group">
                                        <label>2FA Enforcement</label>
                                        <select id="twoFAEnforcement" class="form-control">
                                            <option value="optional">Optional</option>
                                            <option value="required">Required for all</option>
                                            <option value="admin-only">Admin only</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Session Timeout (minutes)</label>
                                        <input type="number" id="sessionTimeout" class="form-control" value="30">
                                    </div>
                                    <div class="form-group">
                                        <label>Password Policy</label>
                                        <select id="passwordPolicy" class="form-control">
                                            <option value="low">Low (8 characters)</option>
                                            <option value="medium">Medium (8 chars, 1 number)</option>
                                            <option value="high">High (10 chars, 1 number, 1 special)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>IP Whitelist</label>
                                        <textarea class="form-control" rows="3" placeholder="Enter IP addresses (one per line)"></textarea>
                                    </div>
                                    <button class="btn btn-primary" onclick="saveSecuritySettings()">Save Settings</button>
                                </div>

                                <!-- Audit Log -->
                                <div class="permission-card">
                                    <h3>Recent Activity Log</h3>
                                    <div style="margin-bottom: 15px;">
                                        <select id="auditLogFilter" class="form-control" onchange="loadAuditLog()">
                                            <option value="all">All Events</option>
                                            <option value="login">Logins</option>
                                            <option value="create">Creations</option>
                                            <option value="update">Updates</option>
                                            <option value="delete">Deletions</option>
                                        </select>
                                    </div>
                                    <div id="auditLogList" style="max-height: 300px; overflow-y: auto;">
                                        <!-- Audit log entries will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Companies Tab -->
                        <div id="companiesTab" class="tab-content" style="display: none;">
                            <div class="admin-grid">
                                <div class="permission-card">
                                    <h3>Subsidiary Companies</h3>
                                    <div id="subsidiariesList">
                                        <!-- Subsidiaries will be loaded here -->
                                    </div>
                                </div>
                                <div class="permission-card">
                                    <h3>Company Settings</h3>
                                    <div id="companySettings">
                                        <!-- Company settings will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Permissions Tab -->
                        <div id="permissionsTab" class="tab-content" style="display: none;">
                            <div class="admin-grid">
                                <div class="permission-card">
                                    <h3>Permission Templates</h3>
                                    <div id="permissionTemplates">
                                        <!-- Templates will be loaded here -->
                                    </div>
                                </div>
                                <div class="permission-card">
                                    <h3>Custom Roles</h3>
                                    <div id="customRoles">
                                        <!-- Custom roles will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Audit Tab -->
                        <div id="auditTab" class="tab-content" style="display: none;">
                            <div class="permission-card">
                                <h3>Audit Log</h3>
                                <div class="form-group" style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <input type="date" id="auditStartDate" class="form-control" style="width: 150px;">
                                    <input type="date" id="auditEndDate" class="form-control" style="width: 150px;">
                                    <select id="auditAction" class="form-control" style="width: 150px;">
                                        <option value="">All Actions</option>
                                        <option value="create">Create</option>
                                        <option value="update">Update</option>
                                        <option value="delete">Delete</option>
                                        <option value="login">Login</option>
                                        <option value="logout">Logout</option>
                                        <option value="permission">Permission Change</option>
                                    </select>
                                    <select id="auditUser" class="form-control" style="width: 150px;">
                                        <option value="">All Users</option>
                                    </select>
                                    <button class="btn btn-primary" onclick="loadAuditLog()">Filter</button>
                                    <button class="btn btn-outline" onclick="exportAuditLog()">Export</button>
                                </div>
                                <div id="auditLogEntries" style="max-height: 500px; overflow-y: auto;">
                                    <!-- Audit entries will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Profile Tab -->
                        <div id="profileTab" class="tab-content" style="display: none;">
                            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 25px;">
                                <div class="permission-card" style="text-align: center;">
                                    <div class="user-avatar" style="width: 100px; height: 100px; margin: 0 auto 20px; font-size: 36px;" id="profileAvatar">
                                        U
                                    </div>
                                    <h3 id="profileName">User Name</h3>
                                    <p id="profileRole">Role</p>
                                    <p id="profileCompany">Company</p>
                                    <div style="margin-top: 20px;">
                                        <button class="btn btn-primary" onclick="changeAvatar()">
                                            <i class="fas fa-camera"></i> Change Photo
                                        </button>
                                    </div>
                                </div>
                                <div class="permission-card">
                                    <h3>Profile Information</h3>
                                    <div class="form-group">
                                        <label>Full Name</label>
                                        <input type="text" id="profileFullName" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" id="profileEmail" class="form-control" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label>Phone</label>
                                        <input type="tel" id="profilePhone" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label>Department</label>
                                        <input type="text" id="profileDepartment" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label>Position</label>
                                        <input type="text" id="profilePosition" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label>Bio</label>
                                        <textarea id="profileBio" class="form-control" rows="4"></textarea>
                                    </div>
                                    <button class="btn btn-primary" onclick="updateProfile()">Update Profile</button>
                                </div>
                            </div>
                        </div>

                        <!-- Settings Tab -->
                        <div id="settingsTab" class="tab-content" style="display: none;">
                            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 25px;">
                                <div class="permission-card">
                                    <div class="menu-item" onclick="showSettings('account')">
                                        <i class="fas fa-user"></i> Account
                                    </div>
                                    <div class="menu-item" onclick="showSettings('notifications')">
                                        <i class="fas fa-bell"></i> Notifications
                                    </div>
                                    <div class="menu-item" onclick="showSettings('privacy')">
                                        <i class="fas fa-lock"></i> Privacy
                                    </div>
                                    <div class="menu-item" onclick="showSettings('appearance')">
                                        <i class="fas fa-palette"></i> Appearance
                                    </div>
                                    <div class="menu-item" onclick="showSettings('integrations')">
                                        <i class="fas fa-plug"></i> Integrations
                                    </div>
                                </div>
                                <div class="permission-card" id="settingsContent">
                                    <!-- Settings content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <!-- Project Modal -->
        <div id="projectModal" class="modal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>Create New Project</h3>
                    <span class="close-modal" onclick="closeProjectModal()">&times;</span>
                </div>
                
                <form id="projectForm" onsubmit="event.preventDefault(); createProject();">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Project Name *</label>
                            <input type="text" id="projectName" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Project Code</label>
                            <input type="text" id="projectCode" class="form-control" placeholder="e.g., PRJ-001">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <div id="projectDescriptionEditor" class="quill-editor"></div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Company</label>
                            <select id="projectCompany" class="form-control">
                                <option value="starks">Starks Galaxy Limited</option>
                                <option value="fortifyai">FortifyAI International</option>
                                <option value="epicsounds">Epic Sounds RL</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Department</label>
                            <select id="projectDepartment" class="form-control">
                                <option value="">Select Department</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Phase</label>
                            <select id="projectPhase" class="form-control">
                                <option value="idea">Idea Phase</option>
                                <option value="planning">Planning Phase</option>
                                <option value="execution">Execution Phase</option>
                                <option value="monitoring">Monitoring Phase</option>
                                <option value="closure">Closure Phase</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Priority</label>
                            <select id="projectPriority" class="form-control">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" id="projectStartDate" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label>Deadline</label>
                            <input type="date" id="projectDeadline" class="form-control">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Budget</label>
                            <input type="number" id="projectBudget" class="form-control" placeholder="Enter budget">
                        </div>
                        
                        <div class="form-group">
                            <label>Currency</label>
                            <select id="projectCurrency" class="form-control">
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Team Members</label>
                        <select id="projectAssignees" class="form-control" multiple style="height: 100px;">
                            <!-- Users will be loaded here -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Milestones</label>
                        <div id="milestonesList"></div>
                        <button type="button" class="btn btn-outline btn-sm" style="margin-top: 10px;" onclick="addMilestone()">
                            <i class="fas fa-plus"></i> Add Milestone
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label>Tags</label>
                        <input type="text" id="projectTags" class="form-control" placeholder="Enter tags separated by commas">
                    </div>
                    
                    <div class="form-group">
                        <label>Attachments</label>
                        <div class="file-upload-area" onclick="document.getElementById('projectFiles').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload or drag and drop</p>
                            <p style="font-size: 12px;">PDF, DOC, Images (Max 10MB)</p>
                        </div>
                        <input type="file" id="projectFiles" multiple style="display: none;" onchange="handleProjectFiles(this.files)">
                        <div class="file-preview" id="projectFilePreview"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Create Project</button>
                </form>
            </div>
        </div>

        <!-- Task Modal -->
        <div id="taskModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create New Task</h3>
                    <span class="close-modal" onclick="closeTaskModal()">&times;</span>
                </div>
                
                <form id="taskForm" onsubmit="event.preventDefault(); createTask();">
                    <div class="form-group">
                        <label>Task Title *</label>
                        <input type="text" id="taskTitle" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="taskDescription" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Project *</label>
                        <select id="taskProject" class="form-control" required onchange="loadTaskStages()">
                            <option value="">Select Project</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Stage</label>
                        <select id="taskStage" class="form-control">
                            <option value="todo">To Do</option>
                            <option value="in-progress">In Progress</option>
                            <option value="review">Review</option>
                            <option value="done">Done</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="taskPriority" class="form-control">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Assignee</label>
                        <select id="taskAssignee" class="form-control">
                            <option value="">Unassigned</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="taskDueDate" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Estimated Hours</label>
                        <input type="number" id="taskHours" class="form-control" placeholder="Enter estimated hours">
                    </div>
                    
                    <div class="form-group">
                        <label>Checklist</label>
                        <div id="checklistItems"></div>
                        <button type="button" class="btn btn-outline btn-sm" style="margin-top: 10px;" onclick="addChecklistItem()">
                            <i class="fas fa-plus"></i> Add Item
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label>Tags</label>
                        <input type="text" id="taskTags" class="form-control" placeholder="Enter tags separated by commas">
                    </div>
                    
                    <div class="form-group">
                        <label>Attachments</label>
                        <input type="file" id="taskFiles" multiple class="form-control">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Create Task</button>
                </form>
            </div>
        </div>

        <!-- Event Modal -->
        <div id="eventModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Calendar Event</h3>
                    <span class="close-modal" onclick="closeEventModal()">&times;</span>
                </div>
                
                <form id="eventForm" onsubmit="event.preventDefault(); addEvent();">
                    <div class="form-group">
                        <label>Event Title *</label>
                        <input type="text" id="eventTitle" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Event Type</label>
                        <select id="eventType" class="form-control">
                            <option value="meeting">Meeting</option>
                            <option value="deadline">Deadline</option>
                            <option value="milestone">Milestone</option>
                            <option value="review">Review</option>
                            <option value="holiday">Holiday</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Start Date & Time</label>
                            <input type="datetime-local" id="eventStart" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label>End Date & Time</label>
                            <input type="datetime-local" id="eventEnd" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>All Day</label>
                        <input type="checkbox" id="eventAllDay" onchange="toggleAllDay()">
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="eventDescription" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="eventLocation" class="form-control" placeholder="Enter location or meeting link">
                    </div>
                    
                    <div class="form-group">
                        <label>Attendees</label>
                        <select id="eventAttendees" class="form-control" multiple style="height: 100px;">
                            <!-- Users will be loaded here -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Color</label>
                        <input type="color" id="eventColor" class="form-control" value="#2563eb">
                    </div>
                    
                    <div class="form-group">
                        <label>Reminder</label>
                        <select id="eventReminder" class="form-control">
                            <option value="0">No reminder</option>
                            <option value="5">5 minutes before</option>
                            <option value="15">15 minutes before</option>
                            <option value="30">30 minutes before</option>
                            <option value="60">1 hour before</option>
                            <option value="1440">1 day before</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Repeat</label>
                        <select id="eventRepeat" class="form-control">
                            <option value="none">Does not repeat</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Add Event</button>
                </form>
            </div>
        </div>

        <!-- User Modal -->
        <div id="userModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New User</h3>
                    <span class="close-modal" onclick="closeUserModal()">&times;</span>
                </div>
                
                <form id="userForm" onsubmit="event.preventDefault(); addUser();">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="newUserName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="newUserEmail" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Company</label>
                        <select id="newUserCompany" class="form-control">
                            <option value="starks">Starks Galaxy Limited</option>
                            <option value="fortifyai">FortifyAI International</option>
                            <option value="epicsounds">Epic Sounds RL</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Department</label>
                        <input type="text" id="newUserDepartment" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Position</label>
                        <input type="text" id="newUserPosition" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Role</label>
                        <select id="newUserRole" class="form-control">
                            <option value="user">Team Member</option>
                            <option value="manager">Project Manager</option>
                            <option value="artist">Artist/Creative</option>
                            <option value="admin">Administrator</option>
                            <option value="client">Client</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Send Invitation</label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="sendInvite" checked>
                            Send email invitation
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Add User</button>
                </form>
            </div>
        </div>

        <!-- Company Modal -->
        <div id="companyModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New Company</h3>
                    <span class="close-modal" onclick="closeCompanyModal()">&times;</span>
                </div>
                
                <form id="companyForm" onsubmit="event.preventDefault(); createCompany();">
                    <div class="form-group">
                        <label>Company Name *</label>
                        <input type="text" id="companyName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Company Code</label>
                        <input type="text" id="companyCode" class="form-control" placeholder="e.g., FORTIFY">
                    </div>
                    
                    <div class="form-group">
                        <label>Domain</label>
                        <input type="text" id="companyDomain" class="form-control" placeholder="company.starksgalaxy.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Logo</label>
                        <input type="file" id="companyLogo" class="form-control" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label>Primary Color</label>
                        <input type="color" id="companyColor" class="form-control" value="#2563eb">
                    </div>
                    
                    <div class="form-group">
                        <label>Subscription Plan</label>
                        <select id="companyPlan" class="form-control">
                            <option value="basic">Basic</option>
                            <option value="professional">Professional</option>
                            <option value="enterprise">Enterprise</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Max Users</label>
                        <input type="number" id="companyMaxUsers" class="form-control" value="10">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Create Company</button>
                </form>
            </div>
        </div>

        <!-- Notification Panel -->
        <div id="notificationPanel" class="notification-panel">
            <div class="notification-header">
                <h4>Notifications</h4>
                <div style="display: flex; gap: 10px;">
                    <span onclick="markAllAsRead()" style="color: var(--primary); cursor: pointer; font-size: 13px;">Mark all as read</span>
                    <span onclick="clearAllNotifications()" style="color: var(--danger); cursor: pointer; font-size: 13px;">Clear all</span>
                </div>
            </div>
            <div id="notificationList" class="notification-list">
                <!-- Notifications will be loaded here -->
            </div>
        </div>

        <!-- Keyboard Shortcuts Modal -->
        <div id="shortcutsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Keyboard Shortcuts</h3>
                    <span class="close-modal" onclick="closeShortcutsModal()">&times;</span>
                </div>
                
                <div class="shortcuts-grid">
                    <div class="shortcut-item">
                        <span>Search</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">K</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>New Task</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">T</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>New Project</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">P</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Save</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">S</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Go to Dashboard</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">D</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Go to Tasks</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">Shift</span>
                            <span class="shortcut-key">T</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Open Chat</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">C</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle Sidebar</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">B</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Quick Actions</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key"></span>
                            <span class="shortcut-key">/</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Help</span>
                        <div class="shortcut-keys">
                            <span class="shortcut-key">?</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onboarding Tutorial -->
        <div id="onboardingTooltip" class="onboarding-tooltip" style="display: none;">
            <div class="onboarding-arrow top"></div>
            <div class="onboarding-title" id="onboardingTitle">Welcome to Starks Galaxy Hub!</div>
            <div class="onboarding-text" id="onboardingText">Let's take a quick tour of your new online office.</div>
            <div class="onboarding-progress" id="onboardingProgress">
                <span class="progress-dot active"></span>
                <span class="progress-dot"></span>
                <span class="progress-dot"></span>
                <span class="progress-dot"></span>
                <span class="progress-dot"></span>
            </div>
            <div class="onboarding-buttons">
                <button class="btn btn-outline btn-sm" onclick="skipTutorial()">Skip</button>
                <button class="btn btn-primary btn-sm" onclick="nextTutorial()">Next</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gantt-schedule-timeline-calendar@3.16.3/dist/gstc.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script>
        // Firebase Configuration (using existing config)
        const firebaseConfig = {
            apiKey: "AIzaSyDyre2oxURYXHZOLIHUeG2itz56i5ehAYo",
            authDomain: "company-doc-generator.firebaseapp.com",
            projectId: "company-doc-generator",
            storageBucket: "company-doc-generator.firebasestorage.app",
            messagingSenderId: "891677147775",
            appId: "1:891677147775:web:a1ffebf23572f5ca18f54a",
            measurementId: "G-1MMCF9W7HF"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Enable offline persistence
        db.enablePersistence()
            .catch((err) => {
                if (err.code == 'failed-precondition') {
                    console.log('Multiple tabs open, persistence enabled in one tab only');
                } else if (err.code == 'unimplemented') {
                    console.log('Browser doesn\'t support persistence');
                }
            });

        // Global variables
        let currentUser = null;
        let currentUserRole = 'user';
        let currentCompany = 'starks';
        let currentUserPermissions = {};
        let notifications = [];
        let unsubscribeNotifications = null;
        let charts = {};
        let quillEditors = {};
        let ganttInstance = null;
        let timerInterval = null;
        let timerSeconds = 0;
        let currentChannel = 'general';
        let videoCallActive = false;
        let currentFolder = 'root';
        let offlineQueue = [];
        let onboardingStep = 0;
        let isOffline = false;

        // Permission definitions
        const permissions = {
            superadmin: {
                canManageCompanies: true,
                canManageAllUsers: true,
                canViewAllProjects: true,
                canManagePermissions: true,
                canAccessVault: true,
                canGenerateReports: true,
                canManageBilling: true,
                canDeleteData: true
            },
            admin: {
                canManageUsers: true,
                canViewAllProjects: true,
                canDeleteProjects: true,
                canEditSettings: true,
                canAccessVault: true,
                canGenerateReports: true,
                canManagePermissions: true
            },
            manager: {
                canViewAllProjects: true,
                canManageTeam: true,
                canCreateProjects: true,
                canAccessVault: false,
                canGenerateReports: true,
                canApproveTasks: true
            },
            artist: {
                canViewAssignedProjects: true,
                canUploadPortfolio: true,
                canViewBriefs: true,
                canTrackTime: true,
                canAccessVault: false,
                canGenerateReports: false
            },
            user: {
                canViewAssignedTasks: true,
                canTrackTime: true,
                canUseChat: true,
                canAccessVault: false,
                canGenerateReports: false
            },
            client: {
                canViewClientProjects: true,
                canProvideFeedback: true,
                canViewInvoices: true,
                canDownloadDeliverables: true,
                canUseClientPortal: true
            }
        };

        // Module visibility settings
        let moduleVisibility = {
            dashboard: true,
            projects: true,
            tasks: true,
            calendar: true,
            chat: true,
            video: true,
            team: true,
            artists: true,
            portfolio: true,
            briefs: true,
            rights: true,
            gantt: true,
            time: true,
            expenses: true,
            hr: true,
            documents: true,
            vault: false,
            templates: true,
            clients: true,
            portal: true,
            invoices: true,
            reports: true,
            analytics: true,
            workflows: true,
            rules: true,
            admin: false,
            companies: false,
            permissions: false,
            audit: false,
            security: false
        };

        // Check for offline status
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        function updateOnlineStatus() {
            isOffline = !navigator.onLine;
            if (isOffline) {
                showNotification('You are offline. Changes will be synced when connection resumes.', 'warning');
            } else {
                showNotification('Connection restored. Syncing data...', 'success');
                syncOfflineData();
            }
        }

        // Auth state observer
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('userAvatar').textContent = user.email[0].toUpperCase();
                document.getElementById('dropdownUserName').textContent = user.displayName || user.email;
                document.getElementById('dropdownUserEmail').textContent = user.email;
                
                await loadUserRole();
                await loadUserPermissions();
                await loadModuleVisibility();
                await loadDashboardData();
                await loadNotifications();
                setupRealtimeListeners();
                initializeCalendar();
                initializeCharts();
                initializeRichTextEditors();
                applyPermissions();
                checkFirstTimeUser();
                setupKeyboardShortcuts();
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        // Authentication functions
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const remember = document.getElementById('rememberMe').checked;
            
            showLoading();
            
            auth.setPersistence(remember ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION)
                .then(() => {
                    return auth.signInWithEmailAndPassword(email, password);
                })
                .then(async (userCredential) => {
                    await logAudit('login', 'User logged in');
                    hideLoading();
                })
                .catch(error => {
                    hideLoading();
                    showError('Login failed: ' + error.message);
                });
        }

        function handleRegister() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const company = document.getElementById('regCompany').value;
            const department = document.getElementById('regDepartment').value;
            const role = document.getElementById('regRole').value;
            
            if (!name || !email) {
                showError('Please fill in all required fields');
                return;
            }
            
            showLoading();
            
            // Create user in Firestore (admin will approve and create auth account)
            db.collection('registrationRequests').add({
                name: name,
                email: email,
                company: company,
                department: department,
                role: role,
                status: 'pending',
                createdAt: new Date()
            })
            .then(() => {
                hideLoading();
                showNotification('Registration request submitted. An admin will review and approve your account.', 'success');
                showLogin();
            })
            .catch(error => {
                hideLoading();
                showError('Registration failed: ' + error.message);
            });
        }

        function handleLogout() {
            if (unsubscribeNotifications) {
                unsubscribeNotifications();
            }
            logAudit('logout', 'User logged out');
            auth.signOut();
        }

        function forgotPassword() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'block';
        }

        function resetPassword() {
            const email = document.getElementById('resetEmail').value;
            
            if (!email) {
                showError('Please enter your email');
                return;
            }
            
            showLoading();
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    hideLoading();
                    showNotification('Password reset email sent!', 'success');
                    showLogin();
                })
                .catch(error => {
                    hideLoading();
                    showError('Error: ' + error.message);
                });
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
        }

        // Load user role and permissions
        async function loadUserRole() {
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                currentUserRole = userData.role;
                currentCompany = userData.company || 'starks';
                currentUserPermissions = permissions[currentUserRole] || permissions.user;
                
                if (currentUserRole === 'admin' || currentUserRole === 'superadmin') {
                    document.getElementById('adminMenuSection').style.display = 'block';
                }
                
                document.getElementById('currentCompany').textContent = getCompanyName(currentCompany);
            }
        }

        function getCompanyName(companyId) {
            const companies = {
                'starks': 'Starks Galaxy Limited',
                'fortifyai': 'FortifyAI International',
                'epicsounds': 'Epic Sounds RL'
            };
            return companies[companyId] || companyId;
        }

        async function loadUserPermissions() {
            const permDoc = await db.collection('permissions').doc(currentUser.uid).get();
            if (permDoc.exists) {
                currentUserPermissions = { ...currentUserPermissions, ...permDoc.data() };
            }
        }

        async function loadModuleVisibility() {
            const settingsDoc = await db.collection('settings').doc('moduleVisibility').get();
            if (settingsDoc.exists) {
                const settings = settingsDoc.data();
                moduleVisibility = { ...moduleVisibility, ...settings };
            }
            applyModuleVisibility();
        }

        function applyModuleVisibility() {
            for (const [module, visible] of Object.entries(moduleVisibility)) {
                const menuItem = document.querySelector(`.menu-item[onclick="switchTab('${module}')"]`);
                if (menuItem) {
                    menuItem.style.display = visible ? 'flex' : 'none';
                }
            }
        }

        function applyPermissions() {
            if (!currentUserPermissions.canAccessVault) {
                const vaultItem = document.querySelector('.menu-item[onclick="switchTab(\'vault\')"]');
                if (vaultItem) vaultItem.style.display = 'none';
            }
            
            if (!currentUserPermissions.canGenerateReports) {
                const reportsItem = document.querySelector('.menu-item[onclick="switchTab(\'reports\')"]');
                if (reportsItem) reportsItem.style.display = 'none';
            }
            
            if (currentUserRole === 'client') {
                document.getElementById('quickActions').style.display = 'none';
            }
        }

        // UI Helper Functions
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showError(message) {
            alert(message); // In production, use a toast notification
        }

        function showNotification(message, type = 'info') {
            console.log(`${type}: ${message}`);
            // In production, show a toast notification
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                showLoading();
                
                // Load projects count
                const projectsSnapshot = await db.collection('projects')
                    .where('company', '==', currentCompany)
                    .get();
                document.getElementById('totalProjects').textContent = projectsSnapshot.size;
                document.getElementById('projectBadge').textContent = projectsSnapshot.size;

                // Load users count
                const usersSnapshot = await db.collection('users')
                    .where('company', '==', currentCompany)
                    .get();
                document.getElementById('teamMembers').textContent = usersSnapshot.size;

                // Load active tasks
                const tasksSnapshot = await db.collection('tasks')
                    .where('status', 'in', ['todo', 'in-progress'])
                    .where('assignee', '==', currentUser.uid)
                    .get();
                document.getElementById('activeTasks').textContent = tasksSnapshot.size;
                document.getElementById('taskBadge').textContent = tasksSnapshot.size;

                // Load completion rate
                const completedTasks = await db.collection('tasks')
                    .where('status', '==', 'done')
                    .where('assignee', '==', currentUser.uid)
                    .get();
                const totalTasks = (await db.collection('tasks')
                    .where('assignee', '==', currentUser.uid)
                    .get()).size;
                const rate = totalTasks > 0 ? Math.round((completedTasks.size / totalTasks) * 100) : 0;
                document.getElementById('completionRate').textContent = rate + '%';

                // Load activity feed
                await loadActivityFeed();
                
                // Load upcoming deadlines
                await loadUpcomingDeadlines();

                // Load online team members
                await loadOnlineTeam();

                // Load recent documents
                await loadRecentDocuments();

                // Load projects for selectors
                await loadProjectSelectors();

                // Load users for selectors
                await loadUserSelectors();

                hideLoading();

            } catch (error) {
                hideLoading();
                console.error('Error loading dashboard data:', error);
            }
        }

        async function loadActivityFeed() {
            const activities = await db.collection('activities')
                .where('company', '==', currentCompany)
                .orderBy('timestamp', 'desc')
                .limit(10)
                .get();

            const feed = document.getElementById('activityFeed');
            feed.innerHTML = '';

            if (activities.empty) {
                feed.innerHTML = '<div class="empty-state"><i class="fas fa-history"></i><h3>No recent activity</h3><p>Activities will appear here</p></div>';
                return;
            }

            activities.forEach(doc => {
                const activity = doc.data();
                const date = activity.timestamp?.toDate ? new Date(activity.timestamp.toDate()).toLocaleString() : new Date().toLocaleString();
                
                feed.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border);">
                        <div style="width: 35px; height: 35px; border-radius: 10px; background: ${getActivityColor(activity.type)}; display: flex; align-items: center; justify-content: center;">
                            <i class="fas ${getActivityIcon(activity.type)}" style="color: white;"></i>
                        </div>
                        <div style="flex: 1;">
                            <strong>${activity.userName || activity.user}</strong> ${activity.action}
                            <div style="font-size: 12px; color: var(--gray);">${date}</div>
                        </div>
                    </div>
                `;
            });
        }

        function getActivityIcon(type) {
            const icons = {
                'project': 'fa-project-diagram',
                'task': 'fa-tasks',
                'user': 'fa-user',
                'comment': 'fa-comment',
                'file': 'fa-file',
                'login': 'fa-sign-in-alt',
                'logout': 'fa-sign-out-alt'
            };
            return icons[type] || 'fa-circle';
        }

        function getActivityColor(type) {
            const colors = {
                'project': '#6366f1',
                'task': '#10b981',
                'user': '#f59e0b',
                'comment': '#8b5cf6',
                'file': '#3b82f6',
                'login': '#10b981',
                'logout': '#ef4444'
            };
            return colors[type] || '#6b7280';
        }

        async function loadUpcomingDeadlines() {
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const tasks = await db.collection('tasks')
                .where('dueDate', '>=', today.toISOString().split('T')[0])
                .where('dueDate', '<=', nextWeek.toISOString().split('T')[0])
                .where('status', '!=', 'done')
                .where('assignee', '==', currentUser.uid)
                .orderBy('dueDate')
                .limit(5)
                .get();

            const deadlines = document.getElementById('upcomingDeadlines');
            deadlines.innerHTML = '';

            if (tasks.empty) {
                deadlines.innerHTML = '<div class="empty-state"><i class="fas fa-calendar-check"></i><p>No upcoming deadlines</p></div>';
                return;
            }

            tasks.forEach(doc => {
                const task = doc.data();
                const dueDate = new Date(task.dueDate).toLocaleDateString();
                
                deadlines.innerHTML += `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--light); border-radius: 10px; margin-bottom: 10px;">
                        <div>
                            <strong>${task.title}</strong>
                            <div style="font-size: 12px; color: var(--gray);">${task.projectName || 'No project'}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: ${getDueDateColor(task.dueDate)};">${dueDate}</div>
                            <div style="font-size: 11px; color: var(--gray);">${task.priority || 'Normal'}</div>
                        </div>
                    </div>
                `;
            });
        }

        function getDueDateColor(dateStr) {
            const today = new Date();
            const dueDate = new Date(dateStr);
            const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) return '#ef4444';
            if (diffDays <= 2) return '#f59e0b';
            return '#10b981';
        }

        async function loadOnlineTeam() {
            const users = await db.collection('users')
                .where('company', '==', currentCompany)
                .where('status', 'in', ['online', 'away', 'busy'])
                .limit(5)
                .get();

            const onlineDiv = document.getElementById('onlineTeam');
            onlineDiv.innerHTML = '';

            users.forEach(doc => {
                const user = doc.data();
                const statusColor = {
                    'online': 'var(--success)',
                    'away': 'var(--warning)',
                    'busy': 'var(--danger)'
                }[user.status] || 'var(--gray)';

                onlineDiv.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; border-bottom: 1px solid var(--border);">
                        <div style="position: relative;">
                            <div class="user-avatar" style="width: 40px; height: 40px; background: ${getAvatarColor(user.name)};">
                                ${(user.name || 'U').charAt(0).toUpperCase()}
                            </div>
                            <span style="position: absolute; bottom: 0; right: 0; width: 10px; height: 10px; border-radius: 50%; background: ${statusColor}; border: 2px solid white;"></span>
                        </div>
                        <div>
                            <strong>${user.name || 'Unknown'}</strong>
                            <div style="font-size: 12px; color: var(--gray);">${user.position || 'Team Member'}</div>
                        </div>
                        <div style="margin-left: auto;">
                            <button class="btn btn-outline btn-sm" onclick="startChat('${doc.id}')">
                                <i class="fas fa-comment"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        async function loadRecentDocuments() {
            const docs = await db.collection('documents')
                .where('company', '==', currentCompany)
                .orderBy('updatedAt', 'desc')
                .limit(5)
                .get();

            const docsDiv = document.getElementById('recentDocuments');
            docsDiv.innerHTML = '';

            if (docs.empty) {
                docsDiv.innerHTML = '<div class="empty-state"><i class="fas fa-file"></i><p>No recent documents</p></div>';
                return;
            }

            docs.forEach(doc => {
                const document = doc.data();
                docsDiv.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="viewDocument('${doc.id}')">
                        <i class="fas fa-file-alt" style="color: var(--primary);"></i>
                        <div style="flex: 1;">
                            <strong>${document.name}</strong>
                            <div style="font-size: 11px; color: var(--gray);">${document.folder || 'Root'}  ${formatFileSize(document.size)}</div>
                        </div>
                    </div>
                `;
            });
        }

        function formatFileSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        async function loadProjectSelectors() {
            const projects = await db.collection('projects')
                .where('company', '==', currentCompany)
                .get();
                
            const projectSelect = document.getElementById('taskProject');
            const projectSelector = document.getElementById('projectSelector');
            const ganttProjectSelector = document.getElementById('ganttProjectSelector');
            const timerProject = document.getElementById('timerProject');
            
            if (projectSelect) {
                projectSelect.innerHTML = '<option value="">Select Project</option>';
            }
            
            if (projectSelector) {
                projectSelector.innerHTML = '<option value="">Select Project</option>';
            }
            
            if (ganttProjectSelector) {
                ganttProjectSelector.innerHTML = '<option value="">Select Project</option>';
            }
            
            if (timerProject) {
                timerProject.innerHTML = '<option value="">Select Project</option>';
            }

            projects.forEach(doc => {
                const project = doc.data();
                const option = `<option value="${doc.id}">${project.name}</option>`;
                
                if (projectSelect) projectSelect.innerHTML += option;
                if (projectSelector) projectSelector.innerHTML += option;
                if (ganttProjectSelector) ganttProjectSelector.innerHTML += option;
                if (timerProject) timerProject.innerHTML += option;
            });
        }

        async function loadUserSelectors() {
            const users = await db.collection('users')
                .where('company', '==', currentCompany)
                .get();
                
            const taskAssignee = document.getElementById('taskAssignee');
            const projectAssignees = document.getElementById('projectAssignees');
            const eventAttendees = document.getElementById('eventAttendees');
            
            if (taskAssignee) {
                taskAssignee.innerHTML = '<option value="">Unassigned</option>';
            }
            
            if (projectAssignees) {
                projectAssignees.innerHTML = '';
            }
            
            if (eventAttendees) {
                eventAttendees.innerHTML = '';
            }

            users.forEach(doc => {
                const user = doc.data();
                const option = document.createElement('option');
                option.value = doc.id;
                option.textContent = user.name || user.email;
                
                if (taskAssignee) taskAssignee.appendChild(option.cloneNode(true));
                if (projectAssignees) projectAssignees.appendChild(option.cloneNode(true));
                if (eventAttendees) eventAttendees.appendChild(option.cloneNode(true));
            });
        }

        // Project functions
        function openProjectModal() {
            document.getElementById('projectModal').classList.add('active');
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('projectStartDate').value = today;
            
            // Initialize rich text editor
            if (!quillEditors.projectDescription) {
                quillEditors.projectDescription = new Quill('#projectDescriptionEditor', {
                    theme: 'snow',
                    placeholder: 'Enter project description...',
                    modules: {
                        toolbar: [
                            ['bold', 'italic', 'underline'],
                            ['link', 'blockquote', 'code-block'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }]
                        ]
                    }
                });
            }
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.remove('active');
        }

        function addMilestone() {
            const milestonesList = document.getElementById('milestonesList');
            const milestoneDiv = document.createElement('div');
            milestoneDiv.className = 'milestone-item';
            milestoneDiv.style.display = 'flex';
            milestoneDiv.style.gap = '10px';
            milestoneDiv.style.marginBottom = '10px';
            
            milestoneDiv.innerHTML = `
                <input type="text" class="form-control milestone-name" placeholder="Milestone name" style="flex: 2;">
                <input type="date" class="form-control milestone-date" style="flex: 1;">
                <input type="number" class="form-control milestone-budget" placeholder="Budget" style="flex: 1;">
                <button type="button" class="btn btn-danger btn-sm" style="width: 40px;" onclick="this.parentElement.remove()"></button>
            `;
            
            milestonesList.appendChild(milestoneDiv);
        }

        function handleProjectFiles(files) {
            const preview = document.getElementById('projectFilePreview');
            preview.innerHTML = '';
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML += `
                        <div class="file-preview-item">
                            ${file.type.startsWith('image/') ? 
                                `<img src="${e.target.result}" alt="${file.name}">` : 
                                `<i class="fas fa-file" style="font-size: 40px; color: var(--primary);"></i>`
                            }
                            <div class="file-preview-remove" onclick="this.parentElement.remove()"></div>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            });
        }

        async function createProject() {
            const name = document.getElementById('projectName').value;
            const code = document.getElementById('projectCode').value;
            const company = document.getElementById('projectCompany').value;
            const department = document.getElementById('projectDepartment').value;
            const phase = document.getElementById('projectPhase').value;
            const priority = document.getElementById('projectPriority').value;
            const startDate = document.getElementById('projectStartDate').value;
            const deadline = document.getElementById('projectDeadline').value;
            const budget = document.getElementById('projectBudget').value;
            const currency = document.getElementById('projectCurrency').value;
            const tags = document.getElementById('projectTags').value;
            const assignees = Array.from(document.getElementById('projectAssignees').selectedOptions).map(opt => opt.value);

            if (!name) {
                showError('Please enter a project name');
                return;
            }

            // Get description from Quill editor
            const description = quillEditors.projectDescription ? quillEditors.projectDescription.root.innerHTML : '';

            // Get milestones
            const milestoneNames = document.querySelectorAll('.milestone-name');
            const milestoneDates = document.querySelectorAll('.milestone-date');
            const milestoneBudgets = document.querySelectorAll('.milestone-budget');
            const milestones = [];

            for (let i = 0; i < milestoneNames.length; i++) {
                if (milestoneNames[i].value) {
                    milestones.push({
                        name: milestoneNames[i].value,
                        date: milestoneDates[i].value,
                        budget: parseFloat(milestoneBudgets[i]?.value) || 0,
                        completed: false
                    });
                }
            }

            const projectData = {
                name: name,
                code: code,
                description: description,
                company: company,
                department: department,
                phase: phase,
                priority: priority,
                startDate: startDate,
                deadline: deadline,
                budget: parseFloat(budget) || 0,
                currency: currency,
                tags: tags ? tags.split(',').map(t => t.trim()) : [],
                assignees: assignees,
                milestones: milestones,
                createdBy: currentUser.uid,
                createdAt: new Date(),
                status: 'active',
                progress: 0,
                spent: 0
            };

            try {
                showLoading();
                
                const projectRef = await db.collection('projects').add(projectData);

                // Upload files if any
                const files = document.getElementById('projectFiles').files;
                if (files.length > 0) {
                    for (let file of files) {
                        const storageRef = storage.ref(`projects/${projectRef.id}/${file.name}`);
                        await storageRef.put(file);
                        await db.collection('projectFiles').add({
                            projectId: projectRef.id,
                            name: file.name,
                            path: storageRef.fullPath,
                            uploadedBy: currentUser.uid,
                            uploadedAt: new Date()
                        });
                    }
                }

                // Create calendar events for milestones
                milestones.forEach(milestone => {
                    if (milestone.date) {
                        db.collection('events').add({
                            title: `Milestone: ${milestone.name} - ${name}`,
                            type: 'milestone',
                            start: milestone.date,
                            end: milestone.date,
                            color: '#10b981',
                            projectId: projectRef.id,
                            company: company,
                            createdBy: currentUser.uid,
                            createdAt: new Date()
                        });
                    }
                });

                // Create activity log
                await db.collection('activities').add({
                    type: 'project',
                    action: `created project "${name}"`,
                    user: currentUser.email,
                    userName: currentUser.displayName || currentUser.email,
                    userId: currentUser.uid,
                    company: company,
                    timestamp: new Date()
                });

                await logAudit('project_create', `Project created: ${name}`);
                
                // Notify assignees
                assignees.forEach(async (userId) => {
                    await createNotification(userId, `You have been assigned to project: ${name}`);
                });

                hideLoading();
                closeProjectModal();
                showNotification('Project created successfully!', 'success');
                loadDashboardData();

            } catch (error) {
                hideLoading();
                showError('Error creating project: ' + error.message);
            }
        }

        // Task functions
        function openTaskModal() {
            document.getElementById('taskModal').classList.add('active');
            
            // Set default due date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('taskDueDate').value = tomorrow.toISOString().split('T')[0];
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
        }

        function addChecklistItem() {
            const checklistDiv = document.getElementById('checklistItems');
            const itemDiv = document.createElement('div');
            itemDiv.style.display = 'flex';
            itemDiv.style.gap = '10px';
            itemDiv.style.marginBottom = '10px';
            
            itemDiv.innerHTML = `
                <input type="text" class="form-control checklist-text" placeholder="Item description" style="flex: 1;">
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()"></button>
            `;
            
            checklistDiv.appendChild(itemDiv);
        }

        async function createTask() {
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const projectId = document.getElementById('taskProject').value;
            const stage = document.getElementById('taskStage').value;
            const priority = document.getElementById('taskPriority').value;
            const assignee = document.getElementById('taskAssignee').value;
            const dueDate = document.getElementById('taskDueDate').value;
            const hours = document.getElementById('taskHours').value;
            const tags = document.getElementById('taskTags').value;

            if (!title || !projectId) {
                showError('Please fill in required fields');
                return;
            }

            // Get checklist items
            const checklistItems = document.querySelectorAll('.checklist-text');
            const checklist = [];
            checklistItems.forEach(item => {
                if (item.value) {
                    checklist.push({
                        text: item.value,
                        completed: false
                    });
                }
            });

            try {
                showLoading();

                // Get project name for reference
                const projectDoc = await db.collection('projects').doc(projectId).get();
                const projectName = projectDoc.data().name;

                // Get assignee name
                let assigneeName = '';
                if (assignee) {
                    const userDoc = await db.collection('users').doc(assignee).get();
                    assigneeName = userDoc.data().name || userDoc.data().email;
                }

                const taskData = {
                    title: title,
                    description: description,
                    projectId: projectId,
                    projectName: projectName,
                    status: stage,
                    priority: priority,
                    assignee: assignee || null,
                    assigneeName: assigneeName,
                    dueDate: dueDate,
                    estimatedHours: parseFloat(hours) || 0,
                    actualHours: 0,
                    checklist: checklist,
                    tags: tags ? tags.split(',').map(t => t.trim()) : [],
                    createdBy: currentUser.uid,
                    createdAt: new Date(),
                    comments: [],
                    attachments: []
                };

                await db.collection('tasks').add(taskData);

                // Upload files if any
                const files = document.getElementById('taskFiles').files;
                if (files.length > 0) {
                    // Handle file uploads
                }

                // Create activity log
                await db.collection('activities').add({
                    type: 'task',
                    action: `created task "${title}" in project "${projectName}"`,
                    user: currentUser.email,
                    userName: currentUser.displayName || currentUser.email,
                    userId: currentUser.uid,
                    company: currentCompany,
                    timestamp: new Date()
                });

                await logAudit('task_create', `Task created: ${title}`);

                // Notify assignee
                if (assignee) {
                    await createNotification(assignee, `New task assigned: ${title}`);
                }

                hideLoading();
                closeTaskModal();
                showNotification('Task created successfully!', 'success');
                loadMyTasks();

            } catch (error) {
                hideLoading();
                showError('Error creating task: ' + error.message);
            }
        }

        async function loadMyTasks() {
            const filter = document.getElementById('taskFilter').value;
            let query = db.collection('tasks')
                .where('assignee', '==', currentUser.uid)
                .orderBy('createdAt', 'desc');
            
            if (filter !== 'all') {
                query = query.where('status', '==', filter);
            }

            try {
                const tasks = await query.get();
                const list = document.getElementById('myTasksList');
                list.innerHTML = '';

                if (tasks.empty) {
                    list.innerHTML = '<div class="empty-state"><i class="fas fa-tasks"></i><h3>No tasks found</h3><p>Create a new task to get started</p><button class="btn btn-primary" onclick="openTaskModal()">Create Task</button></div>';
                    return;
                }

                tasks.forEach(doc => {
                    const task = doc.data();
                    const card = createTaskCard(doc.id, task);
                    list.appendChild(card);
                });

            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }

        function createTaskCard(taskId, task) {
            const card = document.createElement('div');
            card.className = 'kanban-card';
            card.onclick = () => viewTask(taskId);
            
            const dueDateColor = task.dueDate ? getDueDateColor(task.dueDate) : 'var(--gray)';
            const priorityColor = getPriorityColor(task.priority);
            
            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong>${task.title}</strong>
                    <span style="font-size: 11px; padding: 2px 8px; border-radius: 12px; background: ${priorityColor}20; color: ${priorityColor};">
                        ${task.priority}
                    </span>
                </div>
                <div style="font-size: 13px; color: var(--gray); margin-bottom: 10px; max-height: 40px; overflow: hidden;">
                    ${task.description || ''}
                </div>
                ${task.checklist && task.checklist.length > 0 ? `
                    <div style="margin-bottom: 10px;">
                        <div style="font-size: 11px; color: var(--gray); margin-bottom: 5px;">Checklist</div>
                        ${task.checklist.slice(0, 2).map(item => `
                            <div style="display: flex; align-items: center; gap: 5px; font-size: 11px;">
                                <i class="fas ${item.completed ? 'fa-check-circle' : 'fa-circle'}" style="color: ${item.completed ? 'var(--success)' : 'var(--gray)'};"></i>
                                <span>${item.text}</span>
                            </div>
                        `).join('')}
                        ${task.checklist.length > 2 ? `<div style="font-size: 11px; color: var(--gray);">+${task.checklist.length - 2} more</div>` : ''}
                    </div>
                ` : ''}
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px;">
                    <span style="color: ${dueDateColor};">
                        <i class="far fa-calendar"></i> ${task.dueDate || 'No date'}
                    </span>
                    <span><i class="far fa-clock"></i> ${task.estimatedHours || 0}h</span>
                </div>
                <div style="margin-top: 10px; display: flex; gap: 5px;">
                    <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="event.stopPropagation(); updateTaskStatus('${taskId}', 'in-progress')">
                        Start
                    </button>
                    <button class="btn btn-success btn-sm" style="flex: 1;" onclick="event.stopPropagation(); completeTask('${taskId}')">
                        Complete
                    </button>
                </div>
            `;

            return card;
        }

        function getPriorityColor(priority) {
            const colors = {
                'low': '#10b981',
                'medium': '#f59e0b',
                'high': '#ef4444',
                'critical': '#7f1d1d'
            };
            return colors[priority] || '#6b7280';
        }

        async function updateTaskStatus(taskId, newStatus) {
            try {
                await db.collection('tasks').doc(taskId).update({
                    status: newStatus,
                    updatedAt: new Date()
                });

                await logAudit('task_update', `Task ${taskId} moved to ${newStatus}`);
                await createNotification(currentUser.uid, 'Task status updated');
                
                loadMyTasks();

            } catch (error) {
                showError('Error updating task: ' + error.message);
            }
        }

        async function completeTask(taskId) {
            try {
                await db.collection('tasks').doc(taskId).update({
                    status: 'done',
                    completedAt: new Date()
                });

                await logAudit('task_complete', `Task ${taskId} completed`);
                await createNotification(currentUser.uid, 'Task completed! Great job!');
                
                loadMyTasks();

            } catch (error) {
                showError('Error completing task: ' + error.message);
            }
        }

        function viewTask(taskId) {
            showNotification('Task details view - ID: ' + taskId);
        }

        // Chat functions
        async function loadChannels() {
            const channels = await db.collection('channels')
                .where('company', '==', currentCompany)
                .get();

            const channelsDiv = document.getElementById('chatChannels');
            channelsDiv.innerHTML = '';

            channels.forEach(doc => {
                const channel = doc.data();
                channelsDiv.innerHTML += `
                    <div class="channel-item ${doc.id === currentChannel ? 'active' : ''}" onclick="switchChannel('${doc.id}')">
                        <div class="channel-icon">
                            <i class="fas ${channel.type === 'direct' ? 'fa-user' : 'fa-hashtag'}"></i>
                        </div>
                        <div class="channel-info">
                            <div class="channel-name">${channel.name}</div>
                            <div class="channel-last-message">${channel.lastMessage || 'No messages'}</div>
                        </div>
                        ${channel.unread ? '<span class="badge" style="position: static;">' + channel.unread + '</span>' : ''}
                    </div>
                `;
            });
        }

        async function loadMessages(channelId) {
            const messages = await db.collection('messages')
                .where('channelId', '==', channelId)
                .orderBy('timestamp')
                .limit(50)
                .get();

            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.innerHTML = '';

            messages.forEach(doc => {
                const message = doc.data();
                const time = message.timestamp?.toDate ? new Date(message.timestamp.toDate()).toLocaleTimeString() : '';
                
                messagesDiv.innerHTML += `
                    <div class="message">
                        <div class="message-avatar" style="background: ${getAvatarColor(message.senderName)};">
                            ${(message.senderName || 'U').charAt(0).toUpperCase()}
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">${message.senderName || 'Unknown'}</span>
                                <span class="message-time">${time}</span>
                            </div>
                            <div class="message-body">${message.content}</div>
                            ${message.attachments ? `
                                <div class="message-attachments">
                                    ${message.attachments.map(att => `
                                        <div class="message-attachment" onclick="downloadAttachment('${att.path}')">
                                            <i class="fas fa-paperclip"></i> ${att.name}
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            // Scroll to bottom
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function switchChannel(channelId) {
            currentChannel = channelId;
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.channel-item').classList.add('active');
            loadMessages(channelId);
        }

        function sendMessage() {
            const input = document.getElementById('chatMessageInput');
            const content = input.value.trim();
            
            if (!content || !currentChannel) return;
            
            const messageData = {
                channelId: currentChannel,
                senderId: currentUser.uid,
                senderName: currentUser.displayName || currentUser.email,
                content: content,
                timestamp: new Date(),
                readBy: [currentUser.uid]
            };
            
            db.collection('messages').add(messageData);
            input.value = '';
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.onchange = (e) => {
                const file = e.target.files[0];
                // Handle file upload
                showNotification('File upload coming soon', 'info');
            };
            input.click();
        }

        // Video Call functions
        function startVideoCall() {
            document.getElementById('videoCallContainer').classList.add('active');
            videoCallActive = true;
            
            // Add local video placeholder
            const videoGrid = document.getElementById('videoGrid');
            videoGrid.innerHTML = `
                <div class="video-participant">
                    <div class="video-placeholder">
                        <i class="fas fa-user-circle"></i>
                        <span>You</span>
                    </div>
                    <span class="participant-name">You</span>
                </div>
            `;
        }

        function toggleMute() {
            const btn = document.getElementById('muteBtn');
            btn.classList.toggle('active');
            btn.innerHTML = btn.classList.contains('active') ? 
                '<i class="fas fa-microphone-slash"></i>' : 
                '<i class="fas fa-microphone"></i>';
        }

        function toggleVideo() {
            const btn = document.getElementById('videoBtn');
            btn.classList.toggle('active');
            btn.innerHTML = btn.classList.contains('active') ? 
                '<i class="fas fa-video-slash"></i>' : 
                '<i class="fas fa-video"></i>';
        }

        function toggleScreenShare() {
            const btn = document.getElementById('screenBtn');
            btn.classList.toggle('active');
        }

        function endCall() {
            document.getElementById('videoCallContainer').classList.remove('active');
            videoCallActive = false;
        }

        // Calendar functions
        function initializeCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (calendarEl && !calendar) {
                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                    },
                    events: loadCalendarEvents,
                    editable: true,
                    selectable: true,
                    select: function(info) {
                        openEventModal(info.startStr, info.endStr);
                    },
                    eventClick: function(info) {
                        showEventDetails(info.event);
                    },
                    eventDrop: function(info) {
                        updateEventDate(info.event);
                    },
                    eventDidMount: function(info) {
                        info.el.classList.add(`event-${info.event.extendedProps.type}`);
                    }
                });
                calendar.render();
            }
        }

        async function loadCalendarEvents(fetchInfo, successCallback, failureCallback) {
            try {
                const events = await db.collection('events')
                    .where('company', '==', currentCompany)
                    .where('start', '>=', fetchInfo.startStr)
                    .where('start', '<=', fetchInfo.endStr)
                    .get();

                const calendarEvents = [];
                events.forEach(doc => {
                    const event = doc.data();
                    calendarEvents.push({
                        id: doc.id,
                        title: event.title,
                        start: event.start,
                        end: event.end,
                        backgroundColor: event.color || getEventTypeColor(event.type),
                        borderColor: 'transparent',
                        textColor: '#ffffff',
                        extendedProps: {
                            type: event.type,
                            description: event.description,
                            location: event.location
                        }
                    });
                });

                successCallback(calendarEvents);

            } catch (error) {
                failureCallback(error);
            }
        }

        function getEventTypeColor(type) {
            const colors = {
                'meeting': '#6366f1',
                'deadline': '#ef4444',
                'milestone': '#10b981',
                'review': '#f59e0b',
                'holiday': '#8b5cf6',
                'other': '#6b7280'
            };
            return colors[type] || '#6b7280';
        }

        function openEventModal(start, end) {
            document.getElementById('eventModal').classList.add('active');
            document.getElementById('eventStart').value = start || '';
            document.getElementById('eventEnd').value = end || '';
        }

        function closeEventModal() {
            document.getElementById('eventModal').classList.remove('active');
        }

        function toggleAllDay() {
            const allDay = document.getElementById('eventAllDay').checked;
            const startInput = document.getElementById('eventStart');
            const endInput = document.getElementById('eventEnd');
            
            if (allDay) {
                startInput.type = 'date';
                endInput.type = 'date';
            } else {
                startInput.type = 'datetime-local';
                endInput.type = 'datetime-local';
            }
        }

        async function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const type = document.getElementById('eventType').value;
            const start = document.getElementById('eventStart').value;
            const end = document.getElementById('eventEnd').value;
            const description = document.getElementById('eventDescription').value;
            const location = document.getElementById('eventLocation').value;
            const color = document.getElementById('eventColor').value;
            const reminder = document.getElementById('eventReminder').value;
            const repeat = document.getElementById('eventRepeat').value;
            const attendees = Array.from(document.getElementById('eventAttendees').selectedOptions).map(opt => opt.value);

            if (!title || !start) {
                showError('Please fill in required fields');
                return;
            }

            try {
                const eventData = {
                    title: title,
                    type: type,
                    start: start,
                    end: end || start,
                    description: description,
                    location: location,
                    color: color,
                    reminder: parseInt(reminder),
                    repeat: repeat,
                    attendees: attendees,
                    company: currentCompany,
                    createdBy: currentUser.uid,
                    createdAt: new Date()
                };

                await db.collection('events').add(eventData);

                // Set reminder if requested
                if (reminder > 0) {
                    scheduleReminder(eventData);
                }

                calendar.refetchEvents();
                await logAudit('event_create', `Event created: ${title}`);
                await createNotification(currentUser.uid, `New event: ${title}`);
                
                closeEventModal();
                showNotification('Event created successfully!', 'success');

            } catch (error) {
                showError('Error creating event: ' + error.message);
            }
        }

        function scheduleReminder(event) {
            const eventTime = new Date(event.start).getTime();
            const reminderTime = eventTime - (event.reminder * 60 * 1000);
            const now = new Date().getTime();
            
            if (reminderTime > now) {
                setTimeout(() => {
                    createNotification(currentUser.uid, `Reminder: ${event.title} starts in ${event.reminder} minutes`);
                }, reminderTime - now);
            }
        }

        async function updateEventDate(event) {
            await db.collection('events').doc(event.id).update({
                start: event.start.toISOString(),
                end: event.end?.toISOString() || event.start.toISOString()
            });
        }

        function showEventDetails(event) {
            const details = `
                Event: ${event.title}
                Type: ${event.extendedProps.type}
                Start: ${event.start.toLocaleString()}
                Location: ${event.extendedProps.location || 'No location'}
                Description: ${event.extendedProps.description || 'No description'}
            `;
            showNotification(details, 'info');
        }

        // Time Tracking functions
        function startTimer() {
            if (timerInterval) return;
            
            const project = document.getElementById('timerProject').value;
            if (!project) {
                showError('Please select a project');
                return;
            }
            
            timerInterval = setInterval(() => {
                timerSeconds++;
                const hours = Math.floor(timerSeconds / 3600);
                const minutes = Math.floor((timerSeconds % 3600) / 60);
                const seconds = timerSeconds % 60;
                document.getElementById('timerDisplay').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
            
            document.getElementById('startTimerBtn').style.display = 'none';
            document.getElementById('pauseTimerBtn').style.display = 'inline-block';
        }

        function pauseTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                document.getElementById('startTimerBtn').style.display = 'inline-block';
                document.getElementById('pauseTimerBtn').style.display = 'none';
            }
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            const hours = Math.floor(timerSeconds / 3600);
            const project = document.getElementById('timerProject').value;
            const task = document.getElementById('timerTask').value;
            
            if (project && hours > 0) {
                db.collection('timeEntries').add({
                    userId: currentUser.uid,
                    projectId: project,
                    taskId: task || null,
                    hours: hours,
                    date: new Date(),
                    description: 'Manual time entry'
                });
            }
            
            timerSeconds = 0;
            document.getElementById('timerDisplay').textContent = '00:00:00';
            document.getElementById('startTimerBtn').style.display = 'inline-block';
            document.getElementById('pauseTimerBtn').style.display = 'none';
            
            showNotification('Time entry saved!', 'success');
        }

        // Notification functions
        async function loadNotifications() {
            if (!currentUser) return;

            const notificationsRef = db.collection('notifications')
                .where('userId', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .limit(50);

            unsubscribeNotifications = notificationsRef.onSnapshot((snapshot) => {
                notifications = [];
                snapshot.forEach(doc => {
                    notifications.push({ id: doc.id, ...doc.data() });
                });
                updateNotificationBadge();
                renderNotifications();
            });
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            document.getElementById('notificationCount').textContent = unreadCount;
        }

        function renderNotifications() {
            const list = document.getElementById('notificationList');
            list.innerHTML = '';

            if (notifications.length === 0) {
                list.innerHTML = '<div class="empty-state"><i class="far fa-bell"></i><p>No notifications</p></div>';
                return;
            }

            notifications.forEach(notification => {
                const date = notification.createdAt?.toDate ? new Date(notification.createdAt.toDate()).toLocaleString() : '';
                
                const item = document.createElement('div');
                item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                item.onclick = () => markNotificationAsRead(notification.id);
                
                item.innerHTML = `
                    <div class="notification-title">${notification.title || 'Notification'}</div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">${date}</div>
                `;
                
                list.appendChild(item);
            });
        }

        function toggleNotifications() {
            document.getElementById('notificationPanel').classList.toggle('active');
        }

        function markNotificationAsRead(notificationId) {
            db.collection('notifications').doc(notificationId).update({
                read: true
            });
        }

        function markAllAsRead() {
            notifications.forEach(notification => {
                if (!notification.read) {
                    db.collection('notifications').doc(notification.id).update({
                        read: true
                    });
                }
            });
        }

        function clearAllNotifications() {
            notifications.forEach(notification => {
                db.collection('notifications').doc(notification.id).delete();
            });
        }

        async function createNotification(userId, message, title = 'Notification', type = 'info') {
            await db.collection('notifications').add({
                userId: userId,
                title: title,
                message: message,
                type: type,
                read: false,
                createdAt: new Date()
            });
        }

        // Audit logging
        async function logAudit(action, details) {
            if (!currentUser) return;
            
            await db.collection('audit').add({
                userId: currentUser.uid,
                userEmail: currentUser.email,
                userName: currentUser.displayName || currentUser.email,
                action: action,
                details: details,
                company: currentCompany,
                timestamp: new Date(),
                userAgent: navigator.userAgent
            });
        }

        async function loadAuditLog() {
            const filter = document.getElementById('auditLogFilter').value;
            const startDate = document.getElementById('auditStartDate')?.value;
            const endDate = document.getElementById('auditEndDate')?.value;
            
            let query = db.collection('audit')
                .where('company', '==', currentCompany)
                .orderBy('timestamp', 'desc')
                .limit(100);

            if (filter !== 'all') {
                query = query.where('action', '==', filter);
            }

            if (startDate) {
                query = query.where('timestamp', '>=', new Date(startDate));
            }

            if (endDate) {
                const endDateTime = new Date(endDate);
                endDateTime.setDate(endDateTime.getDate() + 1);
                query = query.where('timestamp', '<=', endDateTime);
            }

            const logs = await query.get();
            const list = document.getElementById('auditLogList') || document.getElementById('auditLogEntries');
            if (!list) return;
            
            list.innerHTML = '';

            if (logs.empty) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-history"></i><p>No audit logs found</p></div>';
                return;
            }

            logs.forEach(doc => {
                const log = doc.data();
                const date = log.timestamp?.toDate ? new Date(log.timestamp.toDate()).toLocaleString() : '';
                
                list.innerHTML += `
                    <div style="padding: 10px; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${log.action}</strong>
                            <span style="font-size: 11px; color: var(--gray);">${date}</span>
                        </div>
                        <div style="font-size: 12px; margin-top: 5px;">${log.details}</div>
                        <div style="font-size: 11px; color: var(--gray); margin-top: 5px;">
                            User: ${log.userEmail}
                        </div>
                    </div>
                `;
            });
        }

        function exportAuditLog() {
            showNotification('Export feature coming soon', 'info');
        }

        // Real-time listeners
        function setupRealtimeListeners() {
            // Listen for new projects
            db.collection('projects')
                .where('company', '==', currentCompany)
                .onSnapshot((snapshot) => {
                    snapshot.docChanges().forEach((change) => {
                        if (change.type === 'added') {
                            createNotification(currentUser.uid, 'New project created: ' + change.doc.data().name);
                            loadDashboardData();
                        }
                    });
                });

            // Listen for tasks assigned to current user
            if (currentUser) {
                db.collection('tasks')
                    .where('assignee', '==', currentUser.uid)
                    .onSnapshot((snapshot) => {
                        snapshot.docChanges().forEach((change) => {
                            if (change.type === 'added') {
                                createNotification(currentUser.uid, 'New task assigned to you');
                                loadMyTasks();
                            }
                        });
                    });
            }

            // Listen for chat messages
            db.collection('messages')
                .where('channelId', '==', currentChannel)
                .onSnapshot((snapshot) => {
                    snapshot.docChanges().forEach((change) => {
                        if (change.type === 'added' && change.doc.data().senderId !== currentUser.uid) {
                            loadMessages(currentChannel);
                        }
                    });
                });
        }

        // Analytics functions
        function initializeCharts() {
            // Project Progress Chart
            const projectCtx = document.getElementById('projectProgressChart')?.getContext('2d');
            if (projectCtx) {
                charts.projectProgress = new Chart(projectCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Idea', 'Planning', 'Execution', 'Monitoring', 'Closure'],
                        datasets: [{
                            data: [12, 19, 25, 8, 5],
                            backgroundColor: [
                                '#8b5cf6',
                                '#6366f1',
                                '#3b82f6',
                                '#10b981',
                                '#f59e0b'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Team Workload Chart
            const teamCtx = document.getElementById('teamWorkloadChart')?.getContext('2d');
            if (teamCtx) {
                charts.teamWorkload = new Chart(teamCtx, {
                    type: 'bar',
                    data: {
                        labels: ['John', 'Sarah', 'Mike', 'Lisa', 'David'],
                        datasets: [{
                            label: 'Tasks Assigned',
                            data: [8, 12, 6, 9, 7],
                            backgroundColor: '#6366f1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Task Trend Chart
            const trendCtx = document.getElementById('taskTrendChart')?.getContext('2d');
            if (trendCtx) {
                charts.taskTrend = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Completed Tasks',
                            data: [15, 22, 18, 25],
                            borderColor: '#10b981',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Budget Chart
            const budgetCtx = document.getElementById('budgetChart')?.getContext('2d');
            if (budgetCtx) {
                charts.budget = new Chart(budgetCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Project A', 'Project B', 'Project C', 'Project D'],
                        datasets: [{
                            data: [45000, 32000, 28000, 15000],
                            backgroundColor: [
                                '#6366f1',
                                '#8b5cf6',
                                '#ec4899',
                                '#f59e0b'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Time Chart
            const timeCtx = document.getElementById('timeChart')?.getContext('2d');
            if (timeCtx) {
                charts.time = new Chart(timeCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Hours Worked',
                            data: [8, 7.5, 8, 6, 8, 0, 0],
                            borderColor: '#10b981',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Resource Chart
            const resourceCtx = document.getElementById('resourceChart')?.getContext('2d');
            if (resourceCtx) {
                charts.resource = new Chart(resourceCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Design', 'Development', 'Marketing', 'Sales', 'Support'],
                        datasets: [{
                            label: 'Current Allocation',
                            data: [5, 8, 3, 4, 2],
                            backgroundColor: '#6366f1'
                        }, {
                            label: 'Available Capacity',
                            data: [10, 12, 5, 6, 4],
                            backgroundColor: '#10b981'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        function initializeRichTextEditors() {
            // Initialize any additional rich text editors
        }

        // Utility functions
        function getRandomColor(str) {
            const colors = ['#6366f1', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#3b82f6'];
            if (!str) return colors[0];
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        function getAvatarColor(name) {
            return getRandomColor(name || 'user');
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString();
        }

        // UI functions
        function switchTab(tabName) {
            // Update menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            if (event && event.target) {
                const menuItem = event.target.closest('.menu-item');
                if (menuItem) menuItem.classList.add('active');
            }

            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Show selected tab
            const tabElement = document.getElementById(tabName + 'Tab');
            if (tabElement) {
                tabElement.style.display = 'block';
            }
            
            document.getElementById('pageTitle').textContent = tabName.charAt(0).toUpperCase() + tabName.slice(1);

            // Load tab-specific data
            switch(tabName) {
                case 'projects':
                    loadAllProjects();
                    break;
                case 'tasks':
                    loadMyTasks();
                    break;
                case 'chat':
                    loadChannels();
                    break;
                case 'artists':
                    loadArtistData();
                    break;
                case 'gantt':
                    loadProjectSelectors();
                    break;
                case 'time':
                    loadTimesheet();
                    break;
                case 'expenses':
                    loadExpenses();
                    break;
                case 'hr':
                    loadHRData();
                    break;
                case 'documents':
                    loadDocuments();
                    break;
                case 'clients':
                    loadClients();
                    break;
                case 'reports':
                    loadRecentReports();
                    break;
                case 'admin':
                    loadUserManagement();
                    break;
                case 'audit':
                    loadAuditLog();
                    break;
                case 'profile':
                    loadProfile();
                    break;
            }
        }

        async function loadAllProjects() {
            const projects = await db.collection('projects')
                .where('company', '==', currentCompany)
                .orderBy('createdAt', 'desc')
                .get();
                
            const container = document.getElementById('projectsList');
            container.innerHTML = '';

            if (projects.empty) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-project-diagram"></i><h3>No projects found</h3><p>Create your first project to get started</p><button class="btn btn-primary" onclick="openProjectModal()">Create Project</button></div>';
                return;
            }

            projects.forEach(doc => {
                const project = doc.data();
                const progress = project.progress || 0;
                
                container.innerHTML += `
                    <div class="kanban-card" onclick="viewProject('${doc.id}')">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span class="card-tag" style="background: ${getPhaseColor(project.phase)}20; color: ${getPhaseColor(project.phase)};">
                                ${project.phase}
                            </span>
                            <span style="color: ${getPriorityColor(project.priority)};">
                                <i class="fas fa-flag"></i> ${project.priority}
                            </span>
                        </div>
                        <h4 style="margin-bottom: 10px;">${project.name}</h4>
                        <p style="font-size: 13px; color: var(--gray); margin-bottom: 15px;">${project.description ? project.description.replace(/<[^>]*>/g, '').substring(0, 100) : ''}${project.description && project.description.length > 100 ? '...' : ''}</p>
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px;">
                                <span>Progress</span>
                                <span>${progress}%</span>
                            </div>
                            <div style="width: 100%; height: 6px; background: var(--border); border-radius: 3px;">
                                <div style="width: ${progress}%; height: 100%; background: var(--primary); border-radius: 3px;"></div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--gray);">
                            <span><i class="far fa-calendar"></i> ${project.deadline ? formatDate(project.deadline) : 'No deadline'}</span>
                            <span><i class="far fa-user"></i> ${project.assignees?.length || 0} members</span>
                        </div>
                        ${project.budget ? `
                            <div style="margin-top: 10px; font-size: 12px; color: var(--gray);">
                                <i class="fas fa-dollar-sign"></i> Budget: $${project.budget.toLocaleString()}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
        }

        function getPhaseColor(phase) {
            const colors = {
                'idea': '#8b5cf6',
                'planning': '#6366f1',
                'execution': '#3b82f6',
                'monitoring': '#10b981',
                'closure': '#f59e0b'
            };
            return colors[phase] || '#6b7280';
        }

        async function loadArtistData() {
            // Load artist tasks
            const tasks = await db.collection('tasks')
                .where('assignee', '==', currentUser.uid)
                .where('status', 'in', ['todo', 'in-progress'])
                .get();

            const tasksList = document.getElementById('artistTasksList');
            tasksList.innerHTML = '<h4 style="margin-bottom: 15px;">Current Tasks</h4>';

            if (tasks.empty) {
                tasksList.innerHTML += '<div class="empty-state"><p>No tasks assigned</p></div>';
            } else {
                tasks.forEach(doc => {
                    const task = doc.data();
                    tasksList.innerHTML += `
                        <div class="kanban-card" style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong>${task.title}</strong>
                                <span style="color: ${getPriorityColor(task.priority)};">
                                    <i class="fas fa-flag"></i>
                                </span>
                            </div>
                            <div style="font-size: 12px; color: var(--gray); margin: 5px 0;">
                                ${task.projectName}  Due: ${task.dueDate ? formatDate(task.dueDate) : 'No date'}
                            </div>
                            <button class="btn btn-primary btn-sm" style="width: 100%; margin-top: 10px;" onclick="updateTaskStatus('${doc.id}', 'in-progress')">
                                Start Task
                            </button>
                        </div>
                    `;
                });
            }

            // Load active briefs
            const briefs = await db.collection('briefs')
                .where('assignee', '==', currentUser.uid)
                .where('status', '==', 'active')
                .get();

            const briefsList = document.getElementById('activeBriefs');
            briefsList.innerHTML = '<h4 style="margin-bottom: 15px;">Active Briefs</h4>';

            if (briefs.empty) {
                briefsList.innerHTML += '<div class="empty-state"><p>No active briefs</p></div>';
            } else {
                briefs.forEach(doc => {
                    const brief = doc.data();
                    briefsList.innerHTML += `
                        <div class="kanban-card" style="margin-bottom: 10px;" onclick="viewBrief('${doc.id}')">
                            <strong>${brief.title}</strong>
                            <div style="font-size: 12px; color: var(--gray); margin: 5px 0;">
                                Deadline: ${brief.deadline ? formatDate(brief.deadline) : 'No deadline'}
                            </div>
                        </div>
                    `;
                });
            }

            // Update performance metrics
            const completedTasks = await db.collection('tasks')
                .where('assignee', '==', currentUser.uid)
                .where('status', '==', 'done')
                .get();

            document.getElementById('tasksCompleted').textContent = completedTasks.size;

            // Calculate on-time rate
            let onTimeCount = 0;
            completedTasks.forEach(doc => {
                const task = doc.data();
                if (task.completedAt && task.dueDate) {
                    const completedDate = task.completedAt.toDate();
                    const dueDate = new Date(task.dueDate);
                    if (completedDate <= dueDate) {
                        onTimeCount++;
                    }
                }
            });

            const onTimeRate = completedTasks.size > 0 
                ? Math.round((onTimeCount / completedTasks.size) * 100) 
                : 0;
            document.getElementById('onTimeRate').textContent = onTimeRate + '%';

            // Random quality rating for demo
            document.getElementById('qualityRating').textContent = (4 + Math.random()).toFixed(1) + '/5';

            // Initialize performance chart
            const ctx = document.getElementById('artistPerformanceChart')?.getContext('2d');
            if (ctx) {
                if (charts.artistPerformance) {
                    charts.artistPerformance.destroy();
                }
                
                charts.artistPerformance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Tasks Completed',
                            data: [5, 8, 6, completedTasks.size],
                            borderColor: '#6366f1',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        function viewBrief(briefId) {
            showNotification('Brief details view - ID: ' + briefId);
        }

        async function loadTimesheet() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const entries = await db.collection('timeEntries')
                .where('userId', '==', currentUser.uid)
                .where('date', '>=', today)
                .get();

            const timesheet = document.getElementById('todaysTimesheet');
            timesheet.innerHTML = '<h4 style="margin-bottom: 15px;">Today\'s Entries</h4>';

            if (entries.empty) {
                timesheet.innerHTML += '<div class="empty-state"><p>No time entries for today</p></div>';
            } else {
                let total = 0;
                entries.forEach(doc => {
                    const entry = doc.data();
                    total += entry.hours || 0;
                    timesheet.innerHTML += `
                        <div class="timesheet-entry">
                            <div>
                                <div class="timesheet-project">${entry.projectName || 'Unknown'}</div>
                                <div class="timesheet-time">${entry.description || 'No description'}</div>
                            </div>
                            <div class="timesheet-duration">${entry.hours}h</div>
                        </div>
                    `;
                });
                timesheet.innerHTML += `
                    <div style="margin-top: 15px; padding: 10px; background: var(--light); border-radius: 8px; display: flex; justify-content: space-between;">
                        <strong>Total</strong>
                        <strong>${total}h</strong>
                    </div>
                `;
            }
        }

        async function loadExpenses() {
            const expenses = await db.collection('expenses')
                .where('userId', '==', currentUser.uid)
                .orderBy('date', 'desc')
                .limit(10)
                .get();

            const list = document.getElementById('expensesList');
            list.innerHTML = '';

            if (expenses.empty) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-receipt"></i><p>No expenses found</p></div>';
                return;
            }

            expenses.forEach(doc => {
                const expense = doc.data();
                list.innerHTML += `
                    <div class="expense-card">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                <span class="expense-category category-${expense.category}">${expense.category}</span>
                                <span class="expense-amount">$${expense.amount}</span>
                            </div>
                            <div style="font-size: 12px; color: var(--gray);">${expense.description || 'No description'}</div>
                            <div style="font-size: 11px; color: var(--gray); margin-top: 5px;">${formatDate(expense.date)}</div>
                        </div>
                        <div class="expense-receipt" onclick="viewReceipt('${expense.receipt}')">
                            <i class="fas fa-receipt"></i>
                        </div>
                    </div>
                `;
            });
        }

        function addExpense() {
            showNotification('Add expense feature coming soon', 'info');
        }

        function viewReceipt(receiptPath) {
            showNotification('View receipt: ' + receiptPath);
        }

        async function loadHRData() {
            // Load leave balance
            const balanceDiv = document.getElementById('leaveBalance');
            balanceDiv.innerHTML = `
                <div class="balance-item">
                    <div class="balance-days">20</div>
                    <div>Vacation Days</div>
                </div>
                <div class="balance-item">
                    <div class="balance-days">10</div>
                    <div>Sick Days</div>
                </div>
                <div class="balance-item">
                    <div class="balance-days">5</div>
                    <div>Personal Days</div>
                </div>
            `;

            // Load leave requests
            const requests = await db.collection('leaveRequests')
                .where('userId', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .limit(5)
                .get();

            const requestsDiv = document.getElementById('leaveRequests');
            requestsDiv.innerHTML = '<h4 style="margin: 20px 0 10px;">Recent Requests</h4>';

            if (requests.empty) {
                requestsDiv.innerHTML += '<div class="empty-state"><p>No leave requests</p></div>';
            } else {
                requests.forEach(doc => {
                    const request = doc.data();
                    requestsDiv.innerHTML += `
                        <div class="leave-request">
                            <div>
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                    <span class="leave-type type-${request.type}">${request.type}</span>
                                    <span class="leave-status status-${request.status}">${request.status}</span>
                                </div>
                                <div style="font-size: 12px;">${formatDate(request.startDate)} - ${formatDate(request.endDate)}</div>
                            </div>
                        </div>
                    `;
                });
            }

            // Load employee directory
            const employees = await db.collection('users')
                .where('company', '==', currentCompany)
                .limit(10)
                .get();

            const directory = document.getElementById('employeeDirectory');
            directory.innerHTML = '';

            employees.forEach(doc => {
                const employee = doc.data();
                directory.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid var(--border);">
                        <div class="user-avatar" style="width: 40px; height: 40px; background: ${getAvatarColor(employee.name)};">
                            ${(employee.name || 'U').charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <strong>${employee.name || 'Unknown'}</strong>
                            <div style="font-size: 12px; color: var(--gray);">${employee.position || 'Team Member'}</div>
                        </div>
                    </div>
                `;
            });
        }

        function requestLeave() {
            showNotification('Request leave feature coming soon', 'info');
        }

        async function loadDocuments() {
            const docs = await db.collection('documents')
                .where('company', '==', currentCompany)
                .where('folder', '==', currentFolder)
                .orderBy('name')
                .get();

            const grid = document.getElementById('documentsGrid');
            grid.innerHTML = '';

            // Add folders first
            const folders = await db.collection('folders')
                .where('company', '==', currentCompany)
                .where('parent', '==', currentFolder)
                .get();

            folders.forEach(doc => {
                const folder = doc.data();
                grid.innerHTML += `
                    <div class="document-folder" onclick="navigateToFolder('${doc.id}')">
                        <i class="fas fa-folder"></i>
                        <h4>${folder.name}</h4>
                        <p>${folder.count || 0} items</p>
                    </div>
                `;
            });

            // Then documents
            docs.forEach(doc => {
                const document = doc.data();
                grid.innerHTML += `
                    <div class="document-file" onclick="viewDocument('${doc.id}')">
                        <i class="fas fa-file-alt"></i>
                        <div class="document-info">
                            <div class="document-name">${document.name}</div>
                            <div class="document-meta">Modified ${document.updatedAt ? formatDate(document.updatedAt.toDate()) : 'Unknown'}</div>
                        </div>
                        <div class="document-actions">
                            <span class="document-version">v${document.version || 1}</span>
                            <i class="fas fa-download" onclick="event.stopPropagation(); downloadDocument('${doc.id}')"></i>
                        </div>
                    </div>
                `;
            });
        }

        function navigateToFolder(folderId) {
            currentFolder = folderId;
            loadDocuments();
            updateBreadcrumb();
        }

        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('documentBreadcrumb');
            if (currentFolder === 'root') {
                breadcrumb.innerHTML = '<span onclick="navigateToFolder(\'root\')">Root</span>';
            } else {
                breadcrumb.innerHTML = `
                    <span onclick="navigateToFolder('root')">Root</span> /
                    <span>${currentFolder}</span>
                `;
            }
        }

        function newFolder() {
            const name = prompt('Enter folder name:');
            if (name) {
                db.collection('folders').add({
                    name: name,
                    company: currentCompany,
                    parent: currentFolder,
                    createdAt: new Date()
                });
            }
        }

        function uploadDocument() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = (e) => {
                const files = e.target.files;
                showNotification('Uploading ' + files.length + ' files...', 'info');
                // Handle file upload
            };
            input.click();
        }

        function viewDocument(docId) {
            showNotification('View document: ' + docId);
        }

        function downloadDocument(docId) {
            showNotification('Download document: ' + docId);
        }

        async function loadClients() {
            const clients = await db.collection('clients')
                .where('company', '==', currentCompany)
                .get();

            const grid = document.getElementById('clientsList');
            grid.innerHTML = '';

            clients.forEach(doc => {
                const client = doc.data();
                grid.innerHTML += `
                    <div class="permission-card" onclick="viewClient('${doc.id}')">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="user-avatar" style="width: 50px; height: 50px; background: ${getAvatarColor(client.name)};">
                                ${(client.name || 'C').charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h4>${client.name}</h4>
                                <p style="color: var(--gray); font-size: 13px;">${client.company || ''}</p>
                                <p style="font-size: 12px;"><i class="far fa-envelope"></i> ${client.email}</p>
                            </div>
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <span class="card-tag">${client.projects || 0} projects</span>
                            <span class="card-tag">${client.status || 'Active'}</span>
                        </div>
                    </div>
                `;
            });
        }

        function addClient() {
            showNotification('Add client feature coming soon', 'info');
        }

        function viewClient(clientId) {
            showNotification('View client: ' + clientId);
        }

        async function loadRecentReports() {
            const reports = await db.collection('reports')
                .where('generatedBy', '==', currentUser.uid)
                .orderBy('generatedAt', 'desc')
                .limit(5)
                .get();

            const list = document.getElementById('recentReportsList');
            list.innerHTML = '';

            if (reports.empty) {
                list.innerHTML = '<div class="empty-state"><p>No reports generated yet</p></div>';
                return;
            }

            reports.forEach(doc => {
                const report = doc.data();
                const date = report.generatedAt?.toDate ? new Date(report.generatedAt.toDate()).toLocaleString() : '';
                
                list.innerHTML += `
                    <div style="padding: 10px; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="viewReport('${doc.id}')">
                        <strong>${report.type.replace('_', ' ').toUpperCase()}</strong>
                        <div style="font-size: 12px; color: var(--gray);">${date}</div>
                    </div>
                `;
            });
        }

        // Report generation
        async function generateReport() {
            const type = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const format = document.getElementById('reportFormat').value;
            const schedule = document.getElementById('reportSchedule').value;

            if (!startDate || !endDate) {
                showError('Please select date range');
                return;
            }

            showLoading();

            try {
                let reportData = {};

                switch(type) {
                    case 'project':
                        reportData = await generateProjectReport(startDate, endDate);
                        break;
                    case 'artist':
                        reportData = await generateArtistReport(startDate, endDate);
                        break;
                    case 'timeline':
                        reportData = await generateTimelineReport(startDate, endDate);
                        break;
                    case 'resource':
                        reportData = await generateResourceReport(startDate, endDate);
                        break;
                    case 'budget':
                        reportData = await generateBudgetReport(startDate, endDate);
                        break;
                    case 'productivity':
                        reportData = await generateProductivityReport(startDate, endDate);
                        break;
                    case 'client':
                        reportData = await generateClientReport(startDate, endDate);
                        break;
                }

                // Save report
                const reportRef = await db.collection('reports').add({
                    type: type,
                    data: reportData,
                    format: format,
                    dateRange: { start: startDate, end: endDate },
                    generatedBy: currentUser.uid,
                    generatedAt: new Date(),
                    schedule: schedule !== 'none' ? schedule : null
                });

                // Schedule if needed
                if (schedule !== 'none') {
                    await db.collection('scheduledReports').add({
                        reportId: reportRef.id,
                        schedule: schedule,
                        recipients: [currentUser.email],
                        nextRun: calculateNextRun(schedule),
                        active: true
                    });
                }

                // Generate file
                let content, filename, mimeType;
                
                if (format === 'pdf') {
                    content = JSON.stringify(reportData, null, 2);
                    filename = `report_${type}_${Date.now()}.pdf`;
                    mimeType = 'application/pdf';
                } else if (format === 'excel') {
                    content = convertToCSV(reportData);
                    filename = `report_${type}_${Date.now()}.csv`;
                    mimeType = 'text/csv';
                } else {
                    content = JSON.stringify(reportData, null, 2);
                    filename = `report_${type}_${Date.now()}.json`;
                    mimeType = 'application/json';
                }

                // Download
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();

                await logAudit('report_generate', `Report generated: ${type}`);
                await createNotification(currentUser.uid, 'Report generated successfully');

                loadRecentReports();

            } catch (error) {
                showError('Error generating report: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        function calculateNextRun(schedule) {
            const date = new Date();
            switch(schedule) {
                case 'daily':
                    date.setDate(date.getDate() + 1);
                    break;
                case 'weekly':
                    date.setDate(date.getDate() + 7);
                    break;
                case 'monthly':
                    date.setMonth(date.getMonth() + 1);
                    break;
            }
            return date;
        }

        async function generateProjectReport(startDate, endDate) {
            const projects = await db.collection('projects')
                .where('company', '==', currentCompany)
                .get();
                
            const tasks = await db.collection('tasks')
                .where('company', '==', currentCompany)
                .get();

            return {
                generatedAt: new Date().toISOString(),
                dateRange: { start: startDate, end: endDate },
                totalProjects: projects.size,
                projects: projects.docs.map(doc => {
                    const project = doc.data();
                    const projectTasks = tasks.docs.filter(t => t.data().projectId === doc.id);
                    
                    return {
                        id: doc.id,
                        name: project.name,
                        phase: project.phase,
                        progress: project.progress,
                        taskCount: projectTasks.length,
                        completedTasks: projectTasks.filter(t => t.data().status === 'done').length,
                        budget: project.budget,
                        spent: project.spent
                    };
                })
            };
        }

        async function generateArtistReport(startDate, endDate) {
            const users = await db.collection('users')
                .where('company', '==', currentCompany)
                .where('role', '==', 'artist')
                .get();
                
            const tasks = await db.collection('tasks')
                .where('company', '==', currentCompany)
                .get();

            return {
                generatedAt: new Date().toISOString(),
                dateRange: { start: startDate, end: endDate },
                artists: users.docs.map(doc => {
                    const user = doc.data();
                    const userTasks = tasks.docs.filter(t => t.data().assignee === doc.id);
                    const completedTasks = userTasks.filter(t => t.data().status === 'done');
                    
                    return {
                        name: user.name,
                        email: user.email,
                        totalTasks: userTasks.length,
                        completedTasks: completedTasks.length,
                        completionRate: userTasks.length ? (completedTasks.length / userTasks.length * 100).toFixed(1) : 0
                    };
                })
            };
        }

        async function generateTimelineReport(startDate, endDate) {
            const tasks = await db.collection('tasks')
                .where('company', '==', currentCompany)
                .where('dueDate', '>=', startDate)
                .where('dueDate', '<=', endDate)
                .get();

            return {
                generatedAt: new Date().toISOString(),
                dateRange: { start: startDate, end: endDate },
                tasks: tasks.docs.map(doc => {
                    const task = doc.data();
                    return {
                        title: task.title,
                        project: task.projectName,
                        dueDate: task.dueDate,
                        status: task.status,
                        assignee: task.assigneeName
                    };
                })
            };
        }

        async function generateResourceReport(startDate, endDate) {
            const users = await db.collection('users')
                .where('company', '==', currentCompany)
                .get();
                
            const tasks = await db.collection('tasks')
                .where('company', '==', currentCompany)
                .get();

            return {
                generatedAt: new Date().toISOString(),
                dateRange: { start: startDate, end: endDate },
                resourceUtilization: users.docs.map(doc => {
                    const user = doc.data();
                    const userTasks = tasks.docs.filter(t => t.data().assignee === doc.id);
                    const totalHours = userTasks.reduce((sum, t) => sum + (t.data().estimatedHours || 0), 0);
                    
                    return {
                        name: user.name,
                        role: user.role,
                        taskCount: userTasks.length,
                        totalEstimatedHours: totalHours
                    };
                })
            };
        }

        async function generateBudgetReport(startDate, endDate) {
            const projects = await db.collection('projects')
                .where('company', '==', currentCompany)
                .get();

            return {
                generatedAt: new Date().toISOString(),
                dateRange: { start: startDate, end: endDate },
                budgetOverview: projects.docs.map(doc => {
                    const project = doc.data();
                    return {
                        name: project.name,
                        budget: project.budget || 0,
                        spent: project.spent || 0,
                        remaining: (project.budget || 0) - (project.spent || 0)
                    };
                })
            };
        }

        async function generateProductivityReport(startDate, endDate) {
            const tasks = await db.collection('tasks')
                .where('company', '==', currentCompany)
                .where('completedAt', '>=', new Date(startDate))
                .where('completedAt', '<=', new Date(endDate))
                .get();

            return {
                generatedAt: new Date().toISOString(),
                dateRange: { start: startDate, end: endDate },
                totalCompleted: tasks.size,
                byUser: {} // Group by user
            };
        }

        async function generateClientReport(startDate, endDate) {
            const clients = await db.collection('clients')
                .where('company', '==', currentCompany)
                .get();

            return {
                generatedAt: new Date().toISOString(),
                dateRange: { start: startDate, end: endDate },
                clients: clients.docs.map(doc => {
                    const client = doc.data();
                    return {
                        name: client.name,
                        company: client.company,
                        projects: client.projects || 0,
                        lastActive: client.lastActive
                    };
                })
            };
        }

        function convertToCSV(data) {
            if (!data || typeof data !== 'object') return '';
            
            const headers = [];
            const rows = [];

            if (data.projects) {
                headers.push('Name', 'Phase', 'Progress', 'Tasks', 'Completed', 'Budget', 'Spent');
                data.projects.forEach(p => {
                    rows.push([p.name, p.phase, p.progress, p.taskCount, p.completedTasks, p.budget, p.spent]);
                });
            } else if (data.artists) {
                headers.push('Name', 'Email', 'Total Tasks', 'Completed', 'Rate');
                data.artists.forEach(a => {
                    rows.push([a.name, a.email, a.totalTasks, a.completedTasks, a.completionRate + '%']);
                });
            }

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.join(','))
            ].join('\n');

            return csvContent;
        }

        function viewReport(reportId) {
            showNotification('View report: ' + reportId);
        }

        // Admin functions
        function openUserModal() {
            document.getElementById('userModal').classList.add('active');
        }

        function closeUserModal() {
            document.getElementById('userModal').classList.remove('active');
        }

        async function addUser() {
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const company = document.getElementById('newUserCompany').value;
            const department = document.getElementById('newUserDepartment').value;
            const position = document.getElementById('newUserPosition').value;
            const role = document.getElementById('newUserRole').value;
            const sendInvite = document.getElementById('sendInvite').checked;

            if (!name || !email) {
                showError('Please fill in required fields');
                return;
            }

            showLoading();

            try {
                // Create user in Firebase Auth (this would normally be done via Admin SDK)
                // For demo, we'll just add to Firestore
                const tempId = 'user_' + Date.now();
                
                await db.collection('users').doc(tempId).set({
                    name: name,
                    email: email,
                    company: company,
                    department: department,
                    position: position,
                    role: role,
                    status: sendInvite ? 'invited' : 'pending',
                    createdAt: new Date(),
                    createdBy: currentUser.uid
                });

                if (sendInvite) {
                    // Send invitation email (simulated)
                    await db.collection('notifications').add({
                        userId: tempId,
                        title: 'Welcome to Starks Galaxy Hub!',
                        message: `Your account has been created. Please check your email for login instructions.`,
                        type: 'success',
                        read: false,
                        createdAt: new Date()
                    });
                }

                await logAudit('user_create', `User created: ${name} (${role})`);

                hideLoading();
                closeUserModal();
                showNotification('User added successfully!', 'success');
                loadUserManagement();

            } catch (error) {
                hideLoading();
                showError('Error adding user: ' + error.message);
            }
        }

        async function loadUserManagement() {
            const users = await db.collection('users')
                .where('company', '==', currentCompany)
                .orderBy('createdAt', 'desc')
                .get();
                
            const list = document.getElementById('userManagementList');
            list.innerHTML = '';

            if (users.empty) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><p>No users found</p></div>';
                return;
            }

            users.forEach(doc => {
                const user = doc.data();
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px;
                    border-bottom: 1px solid var(--border);
                `;

                userDiv.innerHTML = `
                    <div>
                        <strong>${user.name || user.email}</strong>
                        <div style="font-size: 12px; color: var(--gray);">
                            ${user.position || 'No position'}  ${user.department || 'No department'}
                        </div>
                        <div style="font-size: 11px; color: var(--gray); margin-top: 5px;">
                            <span class="status-indicator" style="background: ${user.status === 'online' ? 'var(--success)' : 'var(--gray)'}; display: inline-block;"></span>
                            ${user.status || 'offline'}
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <select class="form-control" style="width: 120px;" onchange="updateUserRole('${doc.id}', this.value)">
                            <option value="user" ${user.role === 'user' ? 'selected' : ''}>User</option>
                            <option value="manager" ${user.role === 'manager' ? 'selected' : ''}>Manager</option>
                            <option value="artist" ${user.role === 'artist' ? 'selected' : ''}>Artist</option>
                            <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                            <option value="client" ${user.role === 'client' ? 'selected' : ''}>Client</option>
                        </select>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser('${doc.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;

                list.appendChild(userDiv);
            });

            // Load role permissions
            loadRolePermissions();
            
            // Load module visibility
            loadModuleVisibilitySettings();
        }

        async function updateUserRole(userId, newRole) {
            try {
                await db.collection('users').doc(userId).update({
                    role: newRole
                });

                await logAudit('user_update', `User ${userId} role changed to ${newRole}`);
                showNotification('User role updated', 'success');

            } catch (error) {
                showError('Error updating role: ' + error.message);
            }
        }

        async function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                try {
                    await db.collection('users').doc(userId).delete();
                    
                    await logAudit('user_delete', `User ${userId} deleted`);
                    showNotification('User deleted', 'success');
                    loadUserManagement();

                } catch (error) {
                    showError('Error deleting user: ' + error.message);
                }
            }
        }

        function loadRolePermissions() {
            const permissionsDiv = document.getElementById('rolePermissions');
            if (!permissionsDiv) return;
            
            permissionsDiv.innerHTML = '';

            for (const [role, perms] of Object.entries(permissions)) {
                if (role === 'superadmin') continue; // Hide superadmin
                
                const roleDiv = document.createElement('div');
                roleDiv.style.marginBottom = '20px';
                
                roleDiv.innerHTML = `
                    <h4 style="margin-bottom: 10px; text-transform: capitalize;">${role}</h4>
                    ${Object.entries(perms).map(([perm, value]) => `
                        <div class="permission-item">
                            <span>${formatPermissionName(perm)}</span>
                            <div class="permission-toggle ${value ? 'active' : ''}" 
                                 onclick="toggleRolePermission('${role}', '${perm}')"></div>
                        </div>
                    `).join('')}
                `;
                
                permissionsDiv.appendChild(roleDiv);
            }
        }

        function formatPermissionName(perm) {
            return perm
                .replace(/([A-Z])/g, ' $1')
                .replace(/^./, str => str.toUpperCase());
        }

        async function toggleRolePermission(role, permission) {
            if (!confirm('Change permission for all users with this role?')) return;
            
            permissions[role][permission] = !permissions[role][permission];
            
            await db.collection('settings').doc('rolePermissions').set(permissions);
            
            loadRolePermissions();
            await logAudit('permission_update', `Permission ${permission} updated for role ${role}`);
            showNotification('Permission updated', 'success');
        }

        function loadModuleVisibilitySettings() {
            const modulesDiv = document.getElementById('moduleVisibility');
            if (!modulesDiv) return;
            
            modulesDiv.innerHTML = '';

            for (const [module, visible] of Object.entries(moduleVisibility)) {
                modulesDiv.innerHTML += `
                    <div class="permission-item">
                        <span style="text-transform: capitalize;">${module}</span>
                        <div class="permission-toggle ${visible ? 'active' : ''}" 
                             onclick="toggleModuleVisibility('${module}')"></div>
                    </div>
                `;
            }
        }

        async function toggleModuleVisibility(module) {
            moduleVisibility[module] = !moduleVisibility[module];
            
            await db.collection('settings').doc('moduleVisibility').set(moduleVisibility);
            
            loadModuleVisibilitySettings();
            applyModuleVisibility();
            await logAudit('module_visibility', `Module ${module} visibility toggled`);
            showNotification('Module visibility updated', 'success');
        }

        async function saveSecuritySettings() {
            const twoFA = document.getElementById('twoFAEnforcement').value;
            const timeout = document.getElementById('sessionTimeout').value;
            const passwordPolicy = document.getElementById('passwordPolicy').value;
            
            await db.collection('settings').doc('security').set({
                twoFAEnforcement: twoFA,
                sessionTimeout: parseInt(timeout),
                passwordPolicy: passwordPolicy,
                updatedAt: new Date()
            });

            await logAudit('security_update', 'Security settings updated');
            showNotification('Security settings saved', 'success');
        }

        // Profile functions
        async function loadProfile() {
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            if (userDoc.exists) {
                const user = userDoc.data();
                
                document.getElementById('profileAvatar').textContent = (user.name || 'U').charAt(0).toUpperCase();
                document.getElementById('profileName').textContent = user.name || 'Unknown';
                document.getElementById('profileRole').textContent = user.role || 'User';
                document.getElementById('profileCompany').textContent = getCompanyName(user.company);
                
                document.getElementById('profileFullName').value = user.name || '';
                document.getElementById('profileEmail').value = user.email || '';
                document.getElementById('profilePhone').value = user.phone || '';
                document.getElementById('profileDepartment').value = user.department || '';
                document.getElementById('profilePosition').value = user.position || '';
                document.getElementById('profileBio').value = user.bio || '';
            }
        }

        async function updateProfile() {
            const name = document.getElementById('profileFullName').value;
            const phone = document.getElementById('profilePhone').value;
            const department = document.getElementById('profileDepartment').value;
            const position = document.getElementById('profilePosition').value;
            const bio = document.getElementById('profileBio').value;

            try {
                await db.collection('users').doc(currentUser.uid).update({
                    name: name,
                    phone: phone,
                    department: department,
                    position: position,
                    bio: bio,
                    updatedAt: new Date()
                });

                showNotification('Profile updated successfully!', 'success');
                loadProfile();

            } catch (error) {
                showError('Error updating profile: ' + error.message);
            }
        }

        function changeAvatar() {
            showNotification('Avatar change feature coming soon', 'info');
        }

        // Settings functions
        function showSettings(section) {
            const content = document.getElementById('settingsContent');
            
            switch(section) {
                case 'account':
                    content.innerHTML = `
                        <h3>Account Settings</h3>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-control" value="${currentUser.email}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Change Password</label>
                            <input type="password" class="form-control" placeholder="Current password">
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" placeholder="New password">
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" placeholder="Confirm new password">
                        </div>
                        <button class="btn btn-primary" onclick="changePassword()">Change Password</button>
                    `;
                    break;
                    
                case 'notifications':
                    content.innerHTML = `
                        <h3>Notification Preferences</h3>
                        <div class="permission-item">
                            <span>Email Notifications</span>
                            <div class="permission-toggle active" onclick="toggleNotification('email')"></div>
                        </div>
                        <div class="permission-item">
                            <span>Push Notifications</span>
                            <div class="permission-toggle active" onclick="toggleNotification('push')"></div>
                        </div>
                        <div class="permission-item">
                            <span>Task Reminders</span>
                            <div class="permission-toggle active" onclick="toggleNotification('tasks')"></div>
                        </div>
                        <div class="permission-item">
                            <span>Mentions</span>
                            <div class="permission-toggle active" onclick="toggleNotification('mentions')"></div>
                        </div>
                        <div class="permission-item">
                            <span>Project Updates</span>
                            <div class="permission-toggle active" onclick="toggleNotification('projects')"></div>
                        </div>
                    `;
                    break;
                    
                case 'privacy':
                    content.innerHTML = `
                        <h3>Privacy Settings</h3>
                        <div class="permission-item">
                            <span>Show online status</span>
                            <div class="permission-toggle active" onclick="togglePrivacy('status')"></div>
                        </div>
                        <div class="permission-item">
                            <span>Show email to team</span>
                            <div class="permission-toggle active" onclick="togglePrivacy('email')"></div>
                        </div>
                        <div class="permission-item">
                            <span>Allow direct messages</span>
                            <div class="permission-toggle active" onclick="togglePrivacy('dm')"></div>
                        </div>
                    `;
                    break;
                    
                case 'appearance':
                    content.innerHTML = `
                        <h3>Appearance</h3>
                        <div class="form-group">
                            <label>Theme</label>
                            <select class="form-control" onchange="changeTheme(this.value)">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="system">System Default</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Font Size</label>
                            <select class="form-control" onchange="changeFontSize(this.value)">
                                <option value="small">Small</option>
                                <option value="medium" selected>Medium</option>
                                <option value="large">Large</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Compact Mode</label>
                            <div class="permission-toggle active" onclick="toggleCompact()"></div>
                        </div>
                    `;
                    break;
                    
                case 'integrations':
                    content.innerHTML = `
                        <h3>Integrations</h3>
                        <div class="permission-item">
                            <span>Google Calendar</span>
                            <button class="btn btn-outline btn-sm">Connect</button>
                        </div>
                        <div class="permission-item">
                            <span>Slack</span>
                            <button class="btn btn-outline btn-sm">Connect</button>
                        </div>
                        <div class="permission-item">
                            <span>Zoom</span>
                            <button class="btn btn-outline btn-sm">Connect</button>
                        </div>
                        <div class="permission-item">
                            <span>Dropbox</span>
                            <button class="btn btn-outline btn-sm">Connect</button>
                        </div>
                    `;
                    break;
            }
        }

        function changePassword() {
            showNotification('Password change feature coming soon', 'info');
        }

        function toggleNotification(type) {
            showNotification('Notification preference updated', 'success');
        }

        function togglePrivacy(type) {
            showNotification('Privacy setting updated', 'success');
        }

        function changeTheme(theme) {
            showNotification('Theme changed to ' + theme);
        }

        function changeFontSize(size) {
            document.documentElement.style.fontSize = 
                size === 'small' ? '14px' : size === 'large' ? '18px' : '16px';
        }

        function toggleCompact() {
            showNotification('Compact mode toggled');
        }

        // Status management
        function setStatus(status) {
            const statusColors = {
                'online': 'var(--success)',
                'away': 'var(--warning)',
                'busy': 'var(--danger)',
                'offline': 'var(--gray)'
            };
            
            document.getElementById('userStatus').style.background = statusColors[status];
            document.getElementById('userStatus').className = `user-status status-${status}`;
            
            db.collection('users').doc(currentUser.uid).update({
                status: status
            });
            
            document.getElementById('userDropdown').classList.remove('active');
            showNotification('Status updated to ' + status);
        }

        // User menu
        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('userDropdown');
            const avatar = document.getElementById('userAvatar');
            if (!avatar.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + K for search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    document.getElementById('globalSearch').focus();
                }
                
                // Ctrl/Cmd + T for new task
                if ((e.ctrlKey || e.metaKey) && e.key === 't') {
                    e.preventDefault();
                    openTaskModal();
                }
                
                // Ctrl/Cmd + P for new project
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    e.preventDefault();
                    openProjectModal();
                }
                
                // Ctrl/Cmd + D for dashboard
                if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                    e.preventDefault();
                    switchTab('dashboard');
                }
                
                // Ctrl/Cmd + / for quick actions
                if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                    e.preventDefault();
                    showQuickActions();
                }
                
                // ? for help
                if (e.key === '?' && !e.ctrlKey && !e.metaKey) {
                    e.preventDefault();
                    showKeyboardShortcuts();
                }
            });
        }

        function showKeyboardShortcuts() {
            document.getElementById('shortcutsModal').classList.add('active');
        }

        function closeShortcutsModal() {
            document.getElementById('shortcutsModal').classList.remove('active');
        }

        function showQuickActions() {
            // Highlight quick actions bar
            document.getElementById('quickActions').style.animation = 'pulse 1s';
            setTimeout(() => {
                document.getElementById('quickActions').style.animation = '';
            }, 1000);
        }

        // Quick actions
        function openQuickTask() {
            openTaskModal();
        }

        function openQuickProject() {
            openProjectModal();
        }

        function openChat() {
            switchTab('chat');
        }

        function startTimer() {
            switchTab('time');
        }

        // Offline sync
        function syncOfflineData() {
            showNotification('Syncing data...', 'info');
            // Implement offline sync logic
        }

        // Onboarding
        function checkFirstTimeUser() {
            const hasSeenTutorial = localStorage.getItem('hasSeenTutorial');
            if (!hasSeenTutorial) {
                startOnboarding();
            }
        }

        function startOnboarding() {
            onboardingStep = 1;
            showOnboardingTooltip('welcome');
        }

        function showOnboardingTooltip(step) {
            const tooltip = document.getElementById('onboardingTooltip');
            tooltip.style.display = 'block';
            
            // Position tooltip based on step
            // This is simplified - in production, you'd position relative to target elements
        }

        function nextTutorial() {
            onboardingStep++;
            if (onboardingStep > 5) {
                skipTutorial();
            } else {
                showOnboardingTooltip('step' + onboardingStep);
            }
        }

        function skipTutorial() {
            document.getElementById('onboardingTooltip').style.display = 'none';
            localStorage.setItem('hasSeenTutorial', 'true');
        }

        // Search functionality
        document.getElementById('globalSearch').addEventListener('input', debounce(async (e) => {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm.length < 2) return;

            // Search projects
            const projects = await db.collection('projects')
                .where('company', '==', currentCompany)
                .get();
                
            const results = [];

            projects.forEach(doc => {
                const project = doc.data();
                if (project.name.toLowerCase().includes(searchTerm) || 
                    (project.description && project.description.toLowerCase().includes(searchTerm))) {
                    results.push({
                        type: 'project',
                        id: doc.id,
                        title: project.name,
                        subtitle: 'Project'
                    });
                }
            });

            // Search tasks
            const tasks = await db.collection('tasks')
                .where('company', '==', currentCompany)
                .get();
                
            tasks.forEach(doc => {
                const task = doc.data();
                if (task.title.toLowerCase().includes(searchTerm)) {
                    results.push({
                        type: 'task',
                        id: doc.id,
                        title: task.title,
                        subtitle: 'Task in ' + task.projectName
                    });
                }
            });

            // Search users
            const users = await db.collection('users')
                .where('company', '==', currentCompany)
                .get();
                
            users.forEach(doc => {
                const user = doc.data();
                if (user.name && user.name.toLowerCase().includes(searchTerm)) {
                    results.push({
                        type: 'user',
                        id: doc.id,
                        title: user.name,
                        subtitle: user.position || 'Team Member'
                    });
                }
            });

            // Display results (in production, show dropdown)
            if (results.length > 0) {
                console.log('Search results:', results);
                showSearchResults(results);
            }
        }, 300));

        function showSearchResults(results) {
            // Implement search results dropdown
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Sidebar functions
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function toggleMobileSidebar() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Set up company selector
            document.querySelectorAll('.company-badge').forEach(badge => {
                badge.addEventListener('click', function() {
                    document.querySelectorAll('.company-badge').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCompany = this.dataset.company;
                });
            });

            // Check if user is already logged in
            if (auth.currentUser) {
                loadDashboardData();
            }
        });
    </script>
</body>
</html>
